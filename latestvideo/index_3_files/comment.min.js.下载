!function(e){function t(o){if(i[o])return i[o].exports;var a=i[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(4)},function(e,t){var i={uncurryThis:function(e){return function(){return e.call.apply(e,arguments)}},curryThis:function(e){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),e.apply(null,t)}},bindFn:function(e,t){var i=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,i.concat(Array.prototype.slice.call(arguments)))}},extend:function(e,t){function i(){}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.__super__=t.prototype,e},mixin:function(e){for(var t=Array.prototype.slice.call(arguments,1),i=0;i<t.length;i++){var o=t[i];for(var a in o)e[a]||(e[a]=o[a])}},distinctArray:function(e){for(var t,i=[],o={},a=0;a<e.length;a++){t=e[a];var s=t+":"+typeof t;o[s]||(i.push(t),o[s]=!0)}return i},browser:{version:function(){var e=navigator.userAgent;return navigator.appVersion,{trident:/Trident/i.test(e),presto:/Presto/i.test(e),webKit:/AppleWebKit/i.test(e),gecko:/Gecko/i.test(e)&&!/KHTML/i.test(e),mobile:/AppleWebKit.*Mobile.*/i.test(e),ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(e),android:/Android/i.test(e)||/Linux/i.test(e),windowsphone:/Windows Phone/i.test(e),iPhone:/iPhone/i.test(e),iPad:/iPad/i.test(e),MicroMessenger:/MicroMessenger/i.test(e),webApp:!/Safari/i.test(e),edge:/edge/i.test(e),weibo:/Weibo/i.test(e),uc:/UCBrowser/i.test(e),qq:/MQQBrowser/i.test(e),baidu:/Baidu/i.test(e)}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase(),lteIE:function(e){return $.browser.msie&&parseInt($.browser.version)<=e}},cookie:{get:function(e){var t=""+document.cookie,i=t.indexOf(e+"=");if(i==-1||""==e)return"";var o=t.indexOf(";",i);return o==-1&&(o=t.length),unescape(t.substring(i+e.length+1,o))},set:function(e,t,i){i=void 0!==i?i:365;var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()+"; path=/; domain=.bilibili.com"},delete:function(e){this.set(e,"",-1)}},readFromLocal:function(e){return this.localStorage._support?localStorage.getItem(e):this.cookie.get(e)},saveToLocal:function(e,t,i){return this.localStorage._support?localStorage.setItem(e,t):this.cookie.set(e,t,i)},localStorage:{_support:!(!window.localStorage||"object"!=typeof window.localStorage),getItem:function(e){return this._support?window.localStorage.getItem(e):null},setItem:function(e,t){this._support&&window.localStorage.setItem(e,t)},removeItem:function(e){this.getItem(e)&&window.localStorage.removeItem(e)}},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(e,t){return t?e:{"<":"","&":"",'"':"",">":"","'":""}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[e]}):""},hashManage:{prependHash:"!",_change:function(e,t){var i,o=location.hash,a={},s="",n=0;o&&(o=o.substring(1),this.prependHash&&(o=o.replace(new RegExp("^"+this.prependHash.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")),""))),i=o.split("&");for(var r=0;r<i.length;r++){var l=i[r].split("=")[0],c=i[r].split("=")[1];l&&(a[l]=decodeURIComponent(c))}if("object"==typeof e)for(var d in e){var p=e[d];p?a[d]=encodeURIComponent(p):p===!1&&delete a[d]}else if(t)a[e]=encodeURIComponent(t);else{if(t!==!1)return"undefined"==typeof e?a:a[e]||null;delete a[e]}for(var m in a)s+=0!=n?"&":this.prependHash,s+=m+"="+a[m],n++;return location.hash=s,a},get:function(e){return this._change(e,null)},set:function(e,t){return this._change(e,t)},clear:function(){location.hash=""}},getColor16:function(e){function t(e){var t=parseInt(e).toString(16);return 1==t.length?"0"+t:t}function i(e){for(var i="#",o=0;o<3;o++)i+=t(e[o]);return i}var o="",a=[];return null!=e.match(/\((.*)\)/)?(a=e.match(/\((.*)\)/)[1].split(","),o=i(a)):null!=e.match(/,+/g)?(a=e.split(","),o=i(a)):o=t(e),o},serializeParam:function(e){var t=[];for(var i in e)if("function"!=(typeof e[i]).toLowerCase()&&"object"!=(typeof e[i]).toLowerCase())t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));else if($.isArray(e[i]))for(var o=0;o<e[i].length;o++)t.push(encodeURIComponent(i)+"[]="+encodeURIComponent(e[i][o]));return t.join("&")},query2json:function(e){if($.isPlainObject(e))return e;if(void 0===e)return{};for(var t=e.split("&"),i={},o=0;o<t.length;o++){var a=t[o].split("=");i[a[0]]=a[1]}return i},hash2json:function(){return window.location.href.split("#").length>1?this.query2json(window.location.href.split("#")[1].split("?")[0].replace(/#/,"")):{}},query:{get:function(e){var t=i.query2json(this._getQuery());return e?t[e]:t},set:function(e,t){var o=i.query2json(this._getQuery()),a=i.hash2json();if("object"==typeof e)for(var s in e)this._set(o,s,e[s]);else this._set(o,e,t);return i.makeUrl("",o,a)},_set:function(e,t,i){return null===i?delete e[t]:e[t]=i,e},_getQuery:function(){return void 0!==window.location.search?window.location.search.substring(1):window.location.href.split("?")[1]?window.location.href.split("?")[1].split("#")[0]:""}},makeUrl:function(e,t,i){var o,a=this.serializeParam(t),s=this.serializeParam(i);return o=a?(e||location.pathname)+"?"+a:e||location.pathname,s&&(o=o+"#"+s),o},formatNum:function(e,t){if(void 0===e||"string"==typeof e&&isNaN(parseInt(e)))return"--";var i={"万":1e4},o="万";t="string"==typeof t?t:o;var a=i[t]||i[o];if(!("string"==typeof e&&e.indexOf(t)>=0)){if("string"==typeof e&&e.indexOf(",")>=0){for(var s=e.split(","),n="",r=0;r<s.length;r++)n+=s[r];e=n}return e=parseInt(e),e>=a&&(e=(e/a).toFixed(1)+t),e}},parseCardProps:function(e,t){var i={"data-gk":e.play,"data-sc":e.favorites,"data-pl":e.review,"data-dm":e.video_review,"data-up":e.author,"data-subtitle":e.subtitle,"data-lm":e.typename||"","data-tg":e.created?new Date(1e3*e.created).format("yyyy-MM-dd hh:mm"):e.create||e.created_at,"data-txt":e.description,"data-yb":e.coins},o="";if("string"==t){for(var a in i)""!=o&&(o+=" "),o+=a+'="'+i[a]+'"';return o}return i},newParseCardProps:function(e,t){var i={"data-gk":e.stat.view,"data-sc":e.stat.favorite,"data-pl":e.stat.reply,"data-dm":e.stat.danmaku,"data-up":e.owner.name,"data-lm":e.tname||"","data-tg":new Date(1e3*e.pubdate).format("yyyy-MM-dd hh:mm"),"data-txt":e.desc,"data-yb":e.stat.coin};return i},protocolRelative:function(e){return/http:|https:/.test(e)?e.replace(/http:|https:/,window.location.protocol):$.browser.msie&&parseInt($.browser.version)<=8?window.location.protocol+e:e},formatDuration:function(e,t,i){if("number"!=typeof e)return e;i=i||-1;var o=this.toFixed(e%60,2),a=t?this.toFixed(Math.floor(e%3600/60),2):this.toFixed(Math.floor(e/60),i),s=t?this.toFixed(Math.floor(e/3600),i):null;return null===s?[a,o].join(":"):[s,a,o].join(":")},isObject:function(e){return"object"==typeof e&&null!==e},isNothing:function(e){return null==e},isUndefined:function(e){return"undefined"==typeof e},join:function(){return Array.prototype.join.call(arguments,"")},random:function(e,t){return this.isNothing(t)&&(t=e,e=0),Math.floor(Math.random()*(t-e+1))+e},debounce:function(e,t,o){function a(){clearTimeout(s),o&&i.isNothing(s)&&e(),s=setTimeout(e,t||100)}var s;return a.clearNext=function(){clearTimeout(s)},a},throttle:function(e,t,i){function o(){n=i.head?0:(new Date).getTime(),s=null,e()}function a(){var a,r=(new Date).getTime();!n&&i.head&&(n=r),a=t-(r-n),a<=0||a>t?(clearTimeout(s),s=null,n=r,e()):s||i.tail||(s=setTimeout(o,a))}var s,n=0;return t=t||200,i=i||{},a.clearNext=function(){clearTimeout(s),s=null,n=0},a},toFixed:function(e,t){if("number"!=typeof e&&"string"!=typeof e)return e;for(e=String(e),t=Number(t)||2;e.length<t;)e="0"+e;return e.length>t?e:e.slice(-t)},thumbnail:function(e,t,i){if("string"!=typeof e)return e;if("undefined"==typeof t)return e;var o,a,s,n,r=e.split("?");return i=i||t,o={midfix:"/"+t+"_"+i,suffix:"_"+t+"x"+i},a={cdn:/^http.+i[0-2]\.hdslb\.com\//,bfs:/^http.+i\d\.hdslb\.com\/bfs\//,group1:/^http.+i\d\.hdslb\.com\/group1\//,other:/(^http.+i\d\.hdslb\.com)(\/.+)/},s={bfs:/_\d+x\d+\./,other:/\/\d+_\d+\//},a.cdn.test(r[0])?s.bfs.test(r[0])||s.other.test(r[0])?e:(a.bfs.test(r[0])||a.group1.test(r[0])?(r[0]+=o.suffix+r[0].slice(r[0].lastIndexOf(".")),e=r.join("?")):(n=a.other.exec(r[0]),n&&(r[0]=n[1]+o.midfix+n[2],e=r.join("?"))),e):e},isWebp:function(){try{return 0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}catch(e){return!1}}(),webp:function(e,t){if(!e)return e;var i=e.match(/(.*\.(jpg|jpeg|gif|png|bmp))(\?.*)?/),o=e.indexOf("/bfs/")!=-1;if(!i||"gif"===i[2]||"bmp"===i[2]||!o)return e;var a=t.w,s=t.h,n=a&&s?"@"+a+"w_"+s+"h":"@",t=i[3]?i[3]:"";return this.isWebp?i[1]+n+".webp"+t:i[1]+n+"."+i[2]+t},isAlpha:function(e,t){var i;return localStorage.getItem("machineDna")?i=localStorage.getItem("machineDna"):(i=parseInt(10*Math.random()+1),localStorage.setItem("machineDna",i)),!!(this.isBeta(e)||t<i)},isBeta:function(e){var t=!1,o=i.cookie.get("DedeUserID").slice(-1);return o&&$.isArray(e)&&(t=$.inArray(+o,e)>-1),t},trimHttp:function(e){return e?e.replace(/^http:/,""):""},getByteLen:function(e){for(var t=0,i=0;i<e.length;i++){var o=e.charAt(i);t+=null!=o.match(/[^\x00-\xff]/gi)?1:.5}return t},videoReport:function(e){window.spmReportData&&(window.spmReportData[e]=e)},customReport:function(e,t){if(window.reportConfig&&window[reportConfig.msgObjects]){var i=window[reportConfig.msgObjects],o=t?t:e;i[e]=o}}};e.exports=i},function(e,t){function i(){}i.prototype={addBlacklist:function(e,t,i){var o=t?t:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:e,act:5,re_src:i||15},xhrFields:{withCredentials:!0}}).done(function(e){o(e)})},follow:function(e,t,i){var o=t?t:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:e,act:1,re_src:i||15},xhrFields:{withCredentials:!0}}).done(function(e){o(e)})},whisperUser:function(e,t){var i=t?t:null;this.todoFriend({act:"add",attention:0,format:"json",uid:e},i)},unFollow:function(e,t,i,o){var a=t?t:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:e,act:i?4:2,re_src:o||15},xhrFields:{withCredentials:!0}}).done(function(e){a(e)})},delFans:function(e,t){var i=t?t:null;this.todoFriend({act:"delFans",attention:0,format:"json",uid:e},i)}},e.exports=i},function(e,t,i){function o(e){if(this.params={evType:"over",center:!0,Overlap:!1,focusShowPos:"up",zIndex:null,animation:"fade",position:null,event:null,bound:!0,margin:5,backdrop:!1,bindInput:!1},"string"==typeof e&&(e={evType:e}),"object"==typeof e)for(var t in this.params)e.hasOwnProperty(t)&&(this.params[t]=e[t])}i(7);var a=2e4;o.prototype={timer:null,msgbox:null,bindobj:null,backobj:null,incomingTimer:null,position:{},reverseMap:{up:"down",down:"up",left:"right",right:"left"},show:function(e,t,i,o,s){if(e=$(e),0!=this.params.Overlap||"yes"!=e.attr("hasMessageBox")){e.attr("hasMessageBox","yes"),"undefined"==typeof i&&(i=1e3),"undefined"==typeof o&&(o="msg"),"button"==i&&(s=o,o=i,i=1e3);var n=i;0==i&&(n=50);var r=this;return r.leftTimer=function(){"button"!=o&&(clearTimeout(r.timer),r.timer=setTimeout(function(){clearTimeout(r.timer),r.close(r)},n))},r.incomingTimer=function(){clearTimeout(r.timer)},this.bindobj=e,this.msgbox=$('<div class="m-layer m_layer"><div class="bg"><div class="content"><div class="mini"><div class="msg-text"><i class="b-icon"></i>'+t+"</div>"+("button"==o?'<div class="btnbox"><a class="b-btn ok">确认</a><a class="b-btn-cancel cancel">取消</a></div>':"")+"</div></div></div></div>").prependTo("body"),this.msgbox.addClass("m-"+o),r.params.backdrop&&(r.backobj=$('<div class="m-backdrop"></div>').css({position:"fixed",top:0,left:0,right:0,bottom:0,opacity:.6,backgroundColor:"#000",zIndex:(r.params.zIndex||a)-1}).appendTo("body")),"over"==this.params.evType?(e.bind("mouseleave",r.leftTimer),e.bind("mouseenter",r.incomingTimer),this.msgbox.bind("mouseenter",function(){clearTimeout(r.timer)}),this.msgbox.bind("mouseleave",r.leftTimer)):e.bind("blur",r.leftTimer),this.setPos(),this.msgbox.css("z-index",r.params.zIndex||a++),this.params.bindInput&&"error"==o&&(e.is(":text")||e.is("textarea")?e.addClass("error").on("focus.m-error",this.closeErrHandler()):e.find(":text,textarea").length>0&&e.addClass("error").find(":text,textarea").on("focus.m-error",this.closeErrHandler())),"button"==o&&(this.msgbox.find(".ok").click(function(){"undefined"!=typeof s&&0==s(r)||r.close()}),this.msgbox.find(".cancel").click(function(){r.close()})),0!=i&&r.leftTimer(),"fade"!=this.params.animation?this.msgbox.addClass(this.params.animation):this.moveIn(this.params.focusShowPos),this.bindobj.data("b-msgbox",this),this.msgbox}},close:function(){var e=this,t=function(){e.msgbox.remove(),e.params.backdrop&&e.backobj.remove(),"over"==e.params.evType&&e.bindobj.off("mouseenter",e.incomingTimer),e.bindobj.off("over"==e.params.evType?"mouseleave":"blur",e.leftTimer)};this.bindobj.attr("hasMessageBox",""),"fade"!=this.params.animation?this.msgbox.removeClass(this.params.animation).fadeOut(200,t):this.msgbox.fadeOut(200,t)},closeErrHandler:function(){var e=this;return function(){var t=e.bindobj.removeClass("error");e.close(),t.is(":text")||t.is("textarea")?t.off("focus.m-error"):t.find(":text,textarea").length>0&&t.find(":text,textarea").off("focus.m-error")}},moveIn:function(e){var t={opacity:1},i=5,o=5;switch(e){case"up":t.top="-=5",o=0;break;case"down":t.top="+=5",i=-i,o=0;break;case"left":t.left="-=5",i=0;break;case"right":t.left="+=5",o=-o,i=0;break;default:t.top="-=5",o=0}this.msgbox.show().css({top:this.position.top+i,left:this.position.left+o,opacity:0}),this.msgbox.animate(t,200)},setPos:function(){this.params.position?(this.position=this.params.position,this.resetBound()):this._pos(this.params.focusShowPos),this.msgbox.css("left",this.position.left),this.msgbox.css("top",this.position.top)},_pos:function(e,t){var i=this.bindobj;switch(this.params.focusShowPos=e,e){case"up":this.position.top=i.offset().top-this.msgbox.outerHeight()-this.params.margin,this.position.left=i.offset().left,this.params.center&&(this.position.left=this.position.left-this.msgbox.outerWidth()/2+i.outerWidth()/2);break;case"down":this.position.top=i.offset().top+i.outerHeight()+this.params.margin,this.position.left=i.offset().left,this.params.center&&(this.position.left=this.position.left-this.msgbox.outerWidth()/2+i.outerWidth()/2);break;case"left":this.position.top=i.offset().top,this.position.left=i.offset().left-this.msgbox.outerWidth()-this.params.margin;break;case"right":this.position.top=i.offset().top,this.position.left=i.offset().left+i.outerWidth()+this.params.margin}if(!this.checkBound(e)){if(t!==!0)return this._pos(this.reverseMap[e],!0);this.setBound("down"),this.setBound("left"),this.position.top-=10,this.position.left+=10}return this.resetBound(),this.position},resetBound:function(e){if(this.params.bound||e===!0)for(var t=["up","down","left","right"],i=0;i<t.length;i++){var o=t[i];this.checkBound(o)||this.setBound(o)}},checkBound:function(e){switch(e){case"up":return this.position.top>=$(window).scrollTop();case"down":return this.position.top+this.msgbox.outerHeight()<=$(window).height()+$(window).scrollTop();case"left":return this.position.left>=$(window).scrollLeft();case"right":return this.position.left+this.msgbox.outerWidth()<=$(window).width()+$(window).scrollLeft();default:return!0}},setBound:function(e){switch(e){case"up":this.position.top=$(window).scrollTop();break;case"down":this.position.top=$(window).height()+$(window).scrollTop()-this.msgbox.outerHeight();break;case"left":this.position.left=$(window).scrollLeft();break;case"right":this.position.left=$(window).width()+$(window).scrollLeft()-this.msgbox.outerWidth()}}},e.exports=o},function(e,t,i){function o(){var e=$.ajax;$.ajax=function(t,i){return"object"==typeof t&&(i=t,t=void 0),"post"!=i.type&&"POST"!=i.type||!i.data||i.data.csrf||$.extend(i.data,{csrf:s.cookie&&s.cookie.get("bili_jct")}),e(t,i)}}function a(){$.fn.paging=function(e){var t=$.extend({pageCount:10,current:1,jump:!1,backFn:function(){}},e);p.init(this,t)}}var s=i(1),n=i(3),r=i(10),l=i(12),c=i(2),d=new c,p=i(11);i(5),function(e){function t(e,t,i,s,n,r){this.noface="//static.hdslb.com/images/member/noface.gif";var l={isLogin:!1,face:this.noface,vipStatus:0,vipType:0};if(this.upId="","object"==typeof t){var c=t;this.oid=c.oid,this.pageType=c.pageType;var s=c.userState;this.jumpId=c.jumpId,this.noPage=c.noPage,this.pageSize=c.pageSize||20,this.dynamicRepost=c.dynamicRepost,this.contentMaxLength=c.contentMaxLength||1e3,this.smallPager=c.smallPager}else this.oid=t,this.pageType=i,this.jumpId=n,this.mounted=r&&r.mounted||null,this.contentMaxLength=1e3;this.sort=0,this.loaded=!1,this.loading=!1,this.firstLoad=!1,this.emojiLoaded=!1,this.userStatus=l,this.fbData=[],this.events={},this.pageInfo={},this.foldedReply={},this.isViewHot=!1,this.readOnly=!1,this.blacklistCode=9,this.blacklist=0,this.assist=0,this._pos=-1;var d=this;if(window.jQuery)o(),a(),this.start(e,s);else{var p=document.createElement("script");p.setAttribute("src","//s1.hdslb.com/bfs/static/jinkela/long/js/jquery/jquery3.3.1.min.js"),document.body.appendChild(p),p.onload=function(){a(),o(),d.start(e,s)}}return this}var i=10,c="//api.bilibili.com/x/v2/reply",p={reply:c,subReply:c+"/reply",report:c+"/report",blacklist:c+"/blacklist",add:c+"/add",emoji:c+"/v2/emojis",setTop:c+"/top",like:c+"/action",hate:c+"/hate",del:c+"/del",jump:c+"/jump",folded:c+"/folded",replyFolded:c+"/reply/folded"},m={header:['<div class="comment-header clearfix">','<div class="tabs-order">','<ul class="clearfix">','<li class="default-sort" data-sort="0">全部评论</li>','<li data-sort="2" class="hot-sort  on">按热度排序</li>','<li data-sort="0" class="new-sort">按时间排序</li>',"</ul>","</div>",'<div class="header-page paging-box"></div>',"</div>"].join("")},u={},f=window.localStorage&&window.localStorage.getItem,h="commentNotice";t.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},t.prototype.trigger=function(e){if(this.events[e]){for(var t=[],i=this,o=1;o<arguments.length;o++)t.push(arguments[o]);this.events[e].forEach(function(e){e.apply(i,t)})}},t.prototype.quickLogin=function(){s.browser.version.mobile?location.href="//passport.bilibili.com/login":window.biliQuickLogin?window.biliQuickLogin(function(e){window.location.reload()}):$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(){window.biliQuickLogin(function(e){window.location.reload()})})},t.prototype.start=function(e,t){var i=this,o={isLogin:!1,face:this.noface,vipStatus:0,vipType:0};this.$root=$(e),this.$root.length&&(this._fixRootPosition(),this.userCard=new l(this.userStatus),this._registerEvent(),t?(this.userStatus=$.extend({},o,t),this.init()):$.ajax({url:"//api.bilibili.com/x/web-interface/nav",type:"GET",dataType:"jsonp",data:{jsonp:"jsonp"},xhrFields:{withCredentials:!0}}).done(function(e){e&&0==e.code&&(i.userStatus=$.extend({},o,e.data))}).always(function(){i.init()}))},t.prototype.init=function(e){e&&(this.userStatus=$.extend({},defaultStatus,e));try{var t=['<div class="bb-comment '+(s.browser.version.mobile?"bb-comment-h5":"")+'">','<div class="reply-notice"></div>',m.header,'<div class="comment-list '+(this.pageSize?"has-limit":"")+'"></div>','<div class="bottom-page '+(s.browser.version.mobile?"paging-box":"paging-box-big")+'"></div>',"</div>"].join("");this.$root.html(t),this._getEmoji(),this.userCard.reset(this.userStatus)}catch(e){window.console&&window.console.log("[comment]",e)}},t.prototype._fixRootPosition=function(){"static"==this.$root.css("position")&&this.$root.css({position:"relative"})},t.prototype._fixEmojiPosition=function(){if(!s.browser.version.mobile){var e;e=$(".comment-fold-bilibili").length>0?$(".comment-fold-bilibili .reply-item"):this.$root.find(".reply-box .reply-item"),e.each(function(e,t){var i=$(t).find(".reply-face"),o=$(t).find(".user"),a=$(t).find(".name");if(i&&o&&a){var s=a.offset().top-o.offset().top;s>10?i.css("top","32px"):i.css("top","0")}})}},t.prototype._getEmoji=function(){var e=this;e.emojiLoaded=!0,$.ajax({url:p.emoji,type:"GET",dataType:"jsonp",data:{jsonp:"jsonp"},cache:!0,jsonpCallback:"emoji"}).done(function(t){if(t&&t.data&&0===t.code){var i=t.data.vip,o=t.data.free||[],a=t.data.mapping||[];e._mkEmojiMap(i),e._mkEmojiMap(o);for(var s in a)u[s]=u[a[s]];e.edata={vip:i,free:o},e._showLoading("<span>loading...</span>"),e.jumpId?e.jumpToReply(e.jumpId):e._isInView(e.$root)&&e.loadPage(1),e.trigger("emojiLoaded")}}).fail(function(){e.emojiLoaded=!1,e.loaded||e._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')})},t.prototype._mkEmojiMap=function(e){for(var t=0;t<e.length;t++)for(var i=0;i<e[t].emojis.length;i++){var o=e[t].emojis[i].name,a=s.trimHttp(e[t].emojis[i].url),n=e[t].emojis[i].size,r={l:50,s:50},l='<img src="'+s.trimHttp(s.webp(a,{w:r[n],h:r[n]}))+'"'+("s"===n?' class="small"':"")+' alt="'+(o.split("_")[1]||"").slice(0,-1)+'">';u[o]=l}},t.prototype._renderNotice=function(e){if(e){var t="",i=f?+window.localStorage.getItem(h):0;if(e.id>i){var o=e.link;o&&o.indexOf("__MID__")!==-1&&o.indexOf("__REQUESTID__")!==-1&&this.userStatus.mid?e.link=o.replace("__MID__",this.userStatus.mid||"__MID__").replace("__REQUESTID__",e.id||"__REQUESTID__"):e.link=o,t+='<div class="notice-item" data-id="'+e.id+'"><i class="icon-close-notice"></i><i class="icon-notice"></i><a href="'+e.link+'" target="_blank">'+e.content+"</a></div>"}this.$root.find(".reply-notice").html(t)}},t.prototype._resolveEmoji=function(e){var t=new RegExp(/\[[^\]]+\]/g);return e.replace(t,function(e){return u[e]||e})},t.prototype._resolveSeek=function(e){var t=this;if(1===this.pageType){var i=/(\d+\#)?(\d+\:){1,2}\d\d/g,o=e.match(i);o&&o.forEach(function(i){if(i.indexOf("#")>0)var o=parseInt(i.split("#")[0]),a=i.split("#")[1];else var o=-1,a=i;if(t._timeStrToNumber(a)){var s=t._timeStrToNumber(a);e=e.replace(i,'<a class="video-seek" data-p="'+o+'" data-time="'+s+'">'+i+"</a>")}})}return e},t.prototype._resolveVote=function(e,t){return t.vote?e.replace(/\{vote:.*}/,'<a class="vote-link" data-id="'+t.vote.id+'" data-name="'+s.unhtml(t.vote.title)+'"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMjggMjkiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDI4IDI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+Cjx0aXRsZT5Hcm91cCAyPC90aXRsZT4KPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CjxnIGlkPSJQYWdlLTEiIHN0eWxlPSJmaWxsOiMwMEExRDYiPgoJPGcgaWQ9IuWwgemdoiI+CgkJPGcgaWQ9Ikdyb3VwLTIiPgoJCQk8ZyBpZD0iUmVjdGFuZ2xlLTUiPgoJCQkJPHBhdGggZD0iTTMuMywyOC4zQzEuNSwyOC4zLDAsMjYuOSwwLDI1VjEwLjFjMC0xLjgsMS41LTMuMywzLjMtMy4zczMuMywxLjUsMy4zLDMuM1YyNUM2LjcsMjYuOSw1LjIsMjguMywzLjMsMjguM3ogTTMuMyw4CgkJCQkJYy0xLjIsMC0yLjEsMS0yLjEsMi4xVjI1YzAsMS4yLDEsMi4xLDIuMSwyLjFzMi4xLTEsMi4xLTIuMVYxMC4xQzUuNSw4LjksNC41LDgsMy4zLDh6Ii8+CgkJCTwvZz4KCQkJPGcgaWQ9IlJlY3RhbmdsZS01XzFfIj4KCQkJCTxwYXRoIGQ9Ik0xNCwyOC40Yy0xLjgsMC0zLjMtMS41LTMuMy0zLjNWMy4zQzEwLjcsMS41LDEyLjIsMCwxNCwwczMuMywxLjUsMy4zLDMuM1YyNUMxNy4zLDI2LjksMTUuOCwyOC40LDE0LDI4LjR6IE0xNCwxLjIKCQkJCQljLTEuMiwwLTIuMSwxLTIuMSwyLjFWMjVjMCwxLjIsMSwyLjEsMi4xLDIuMWMxLjIsMCwyLjEtMSwyLjEtMi4xVjMuM0MxNi4xLDIuMiwxNS4yLDEuMiwxNCwxLjJ6Ii8+CgkJCTwvZz4KCQkJPGcgaWQ9IlJlY3RhbmdsZS01XzJfIj4KCQkJCTxwYXRoIGQ9Ik0yNC43LDI4LjRjLTEuOCwwLTMuMy0xLjUtMy4zLTMuM3YtNi44YzAtMS44LDEuNS0zLjMsMy4zLTMuM3MzLjMsMS41LDMuMywzLjNWMjVDMjgsMjYuOSwyNi41LDI4LjQsMjQuNywyOC40egoJCQkJCSBNMjQuNywxNi4xYy0xLjIsMC0yLjEsMS0yLjEsMi4xVjI1YzAsMS4yLDEsMi4xLDIuMSwyLjFzMi4xLTEsMi4xLTIuMXYtNi44QzI2LjgsMTcsMjUuOCwxNi4xLDI0LjcsMTYuMXoiLz4KCQkJPC9nPgoJCTwvZz4KCTwvZz4KPC9nPgo8L3N2Zz4K" alt="" />'+s.unhtml(t.vote.title)+"</a>"):e},t.prototype._resolveAt=function(e,t){return e.replace(/@[^\s]+/g,function(e){return t[e.trim().substring(1)]||e}).replace(/\n/g,"<br />").replace(/av([0-9]+)/gi,'<a href="//www.bilibili.com/video/av$1/" target="_blank" data-view="$1">av$1</a>').replace(/cv([0-9]+)/gi,'<a href="//www.bilibili.com/read/cv$1/" target="_blank" data-view="$1">cv$1</a>')},t.prototype._timeStrToNumber=function(e){var t=e.split(":");if(3===t.length&&2===t[1].length&&2===t[2].length){var i=parseInt(t[0]),o=parseInt(t[1]),a=parseInt(t[2]);if(o>=0&&o<60&&a>=0&&a<60)return a+60*o+3600*i}if(2===t.length&&2===t[1].length){var o=parseInt(t[0]),a=parseInt(t[1]);if(a>=0&&a<60)return a+60*o}},t.prototype._formateMemberMap=function(e){for(var t,i={},o=0,a=e.length;o<a;++o)t=e[o],i[t.uname]='<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'">@'+s.unhtml(t.uname)+" </a>";return i},t.prototype._createReplyBox=function(e){e=e||{};var t="",i="";this.userStatus.isLogin?(this.userStatus.moral<60&&(t="no-login",s.browser.version.mobile?(t+=" moral",i='节操低于60，无法发送评论。<br>详情点击<a class="login-link b-btn" href="https://account.bilibili.com/site/record?type=moral" target="_blank">节操记录</a><a class="jc-help" href="//www.bilibili.com/blackboard/help.html#%E8%8A%82%E6%93%8D%E7%9B%B8%E5%85%B3" target="_blank"><i class="b-tip jc"></i>如何恢复？</a>'):i='你的节操已低于60，将无法发表评论，详情请点击<a class="login-link b-btn" href="https://account.bilibili.com/site/record?type=moral" target="_blank">我的节操记录</a><a class="jc-help" href="//www.bilibili.com/blackboard/help.html#%E8%8A%82%E6%93%8D%E7%9B%B8%E5%85%B3" target="_blank"><i class="b-tip jc"></i>如何恢复节操值？</a>'),this.userStatus.level_info&&this.userStatus.level_info.current_level<2&&this.userStatus.mid!=this.upId&&(t="no-login",i="您的等级不足，升级至Lv2可参与评论"),this.blacklist&&(t="no-login",i="由于UP主隐私设置，你无法评论！")):(i='请先<a class="b-btn btn-open-mini-Login">登录</a>后发表评论 (・ω・)',t="no-login"),e.forbid&&(i="当前稿件评论功能已关闭",t="no-login"),this.readOnly&&(i="评论区已被冻结，禁止发送评论",t="no-login");var o='<div class="dynamic-repost"><label><input type="checkbox" class="dynamic-repost-checkbox" /><span>同时转发到我的动态</span></label></div>';return['<div class="comment-send '+t+'">','<div class="user-face">','<img class="user-head" src="'+s.trimHttp(s.webp(this.userStatus.face,{w:52,h:52}))+'" />',"</div>",'<div class="textarea-container">',i?'<div class="baffle-wrap"><div class="baffle">'+i+"</div></div>":"",'<i class="ipt-arrow"></i>','<textarea cols="80" name="msg" rows="5" placeholder="请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。" class="ipt-txt"></textarea>','<button type="submit" class="comment-submit" '+(t?'disabled="disabled"':"")+">发表评论</button>","</div>",'<div class="comment-emoji">','<i class="face"></i>','<span class="text">表情</span>',"</div>",!e.isSub&&this.dynamicRepost?o:"","</div>"].join("")},t.prototype.loadPage=function(e,t){var i=this;i.loading=!0,t&&$(window).scrollTop(i.$root.offset().top),i.emoji||(i.emoji=new r(i.$root,i.userStatus.vipStatus,i.edata)),this._getReplyByPage(e).done(function(t){if(i._hideLoading(),i.loaded=!0,t&&0===t.code){if(t.data){i.mode=t.data.mode,i._renderTabs(t),i.blacklist=t.data.blacklist||0,i.assist=t.data.assist||0,i.pageInfo=t.data.page||{},i.readOnly=t.data.config.read_only,i.folder=t.data.folder||{};var o=i.pageInfo.num*i.pageInfo.size>=i.pageInfo.count;i._renderNotice(t.data.notice),i._updateReplyListByData(t.data,e,o),i._renderTopPagination(i.pageInfo),i._renderBottomPagination(i.pageInfo),i._fixEmojiPosition(),$(".common .b-head .results").html(t.data.page.acount||0).show(),$(".common .b-head .del-log").remove(),i.$root.find(".bb-comment > .comment-send").remove(),$(i._createReplyBox()).insertBefore(i.$root.find(".comment-list")),i.trigger("pageLoaded",o,t.data)}}else 12002==t.code&&(i.$root.find(".bb-comment > .comment-send").remove(),$(i._createReplyBox({forbid:!0})).insertBefore(i.$root.find(".comment-list")))}).fail(function(){i.loaded||i._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')}).always(function(){i.loading=!1})},t.prototype._renderTabs=function(e){var t=this.$root.find(".comment-header .tabs-order .default-sort"),i=this.$root.find(".comment-header .tabs-order .new-sort"),o=this.$root.find(".comment-header .tabs-order .hot-sort");if(!this.firstLoad){if(this.firstLoad=!0,2===this.mode)return t.hide().removeClass("on"),i.show().addClass("on"),void o.show().removeClass("on");if(3===this.mode){var a=t.parent();return a.append(i),t.hide().removeClass("on"),i.show(),o.show().addClass("on"),this.sort=2,void this.loadPage(1)}e.data.page&&e.data.page.count>=20||e.data.hots||2===this.sort?o.show():o.hide(),e.data.hots?this.isViewHot=!0:this.isViewHot=!1}},t.prototype._updateReplyListByData=function(e,t,i){var o=[],a=-1,s=this;s.upId=e.upper&&e.upper.mid,s.hasUpTop=e.upper&&e.upper.top,e.top&&1===s.pageInfo.num&&(e.top.isTop=!0,o.push(e.top)),e.upper&&e.upper.top&&1===s.pageInfo.num&&(e.upper.top.isUpTop=!0,o.push(e.upper.top)),e.upper&&e.upper.vote&&1===s.pageInfo.num&&(e.upper.vote.isUpTop=!0,o.push(e.upper.vote)),1===t&&0===s.sort&&2!==s.mode&&3!==s.mode&&(s.isViewHot&&(o=o.concat(e.hots||[])),a=e.hots&&e.hots.length>0?o.length:-1,s._pos=a);var n;n=e.replies instanceof Array?o.length>0?s._uniq(o.concat(e.replies)):o.concat(e.replies):o.length>0?s._uniq(o):o,this.noPage&&this.pageSize&&(n=n.slice(0,this.pageSize)),s._renderReplyList(n,a,i)},t.prototype._uniq=function(e){var t={};return e.filter(function(e){return!t.hasOwnProperty(e.rpid)&&(t[e.rpid]=!0)})},t.prototype._renderTopPagination=function(e){if(!this.noPage){var t=this,i=Math.ceil(e.count/e.size);i>1?this.$root.find(".header-page").paging({pageCount:i,current:e.num,backFn:function(e){t.$root.trigger("replyPageChange",{p:e}),s.videoReport("playpage_comment_pageclick1")}}):this.$root.find(".header-page").html("")}},t.prototype._renderBottomPagination=function(e){if(this.noPage){var t=e.count<=this.pageSize,i="";return i=t?"没有更多了～":'<a class="more-link" href="javascript:">查看更多评论</a>',void this.$root.find(".bottom-page").addClass("center").html(i)}var o=this,a=Math.ceil(e.count/e.size);a>1?this.$root.find(".bottom-page").paging({pageCount:a,current:e.num,jump:!s.browser.version.mobile,smallSize:this.smallPager,backFn:function(e){o.$root.trigger("replyPageChange",{p:e,isBottom:!0}),s.videoReport("playpage_comment_pageclick2")}}):this.$root.find(".bottom-page").html("")},t.prototype._renderReplyList=function(e,t,i){var o="";if(e){this.fbData=e;try{if(0!==e.length||this.noPage){this.$root.find(".no-more-reply").remove();for(var a=0,s=e.length;a<s;++a){var n=e[a];n&&((a<t||n.isUpTop||n.isTop)&&(n.isHot=!0),o+=this._createReplyItem(n,a,t),t&&a===t-1&&this.isViewHot&&t<e.length&&(o+='<div class="hot-line"><span>以上为热门评论，<a class="more-hot">查看更多</a></span></div>'))}i&&this.folder.has_folded&&(o+='<div class="reply-fold-tip"><a class="view-fold">查看被折叠的评论</a><a href="'+this.folder.rule+'" class="fold-rule" target="_blank">（折叠规则）</a></div>')}else o+='<div class="no-more-reply">没有更多信息</div>';this.$root.find(".comment-list").html(o),this.mounted&&this.mounted(e)}catch(e){window.console&&window.console.log("[comment] render ",e)}}},t.prototype._createReplyItem=function(e,t,i){return e.folder&&e.folder.has_folded&&(this.foldedReply[e.rpid]=e),['<div class="list-item reply-wrap '+(e.isTop||e.isUpTop?"is-top":"")+'" data-id="'+e.rpid+'" data-index="'+t+'">',this._createUserFace(e),this._createListCon(e,t,i),"</div>"].join("")},t.prototype._createTopFoldedReplyItem=function(e){return['<div class="list-item reply-wrap top-fold-reply" data-id="'+e.rpid+'">',this._createUserFace(e),this._createTopFoldedListCon(e),"</div>"].join("")},t.prototype._createSubFoldedReplyItem=function(e,t){return['<div class="list-item reply-wrap '+(t?"no-border":"")+'" data-id="'+e.rpid+'">',this._createUserFace(e),this._createSubFoldedListCon(e),"</div>"].join("");
},t.prototype._createLegalizeIcon=function(e){var t="";return e&&0==e.type?t='<div class="legalize p-auth" title="个人认证"></div>':e&&1==e.type&&(t='<div class="legalize o-auth" title="企业/团体认证"></div>'),t},t.prototype._createUserFace=function(e){var t='<div class="user-face"><img src="'+this.noface+'"></div>',i=['<div class="user-face">','<a href="//space.bilibili.com/'+e.mid+'" target="_blank" data-usercard-mid="'+e.mid+'">','<img src="'+s.trimHttp(s.webp(e.member.avatar,s.browser.version.mobile?{w:45,h:45}:{w:52,h:52}))+'" alt="">',"</a>",e.member.pendant&&e.member.pendant.image?'<a href="//space.bilibili.com/'+e.mid+'" class="pendant" data-usercard-mid="'+e.mid+'" target="_blank"><img src="'+s.trimHttp(s.webp(e.member.pendant.image,s.browser.version.mobile?{w:71,h:71}:{w:86,h:86}))+'"></a>':"",this._createLegalizeIcon(e.member.official_verify),e.isHot?this._createFollowButton(e.member,e.rpid):"","</div>"].join("");return e.state===this.blacklistCode?t:i},t.prototype._createFollowButton=function(e,t){function i(e){$.ajax({url:"//api.bilibili.com/x/relation",data:{fid:e.mid,jsonp:"jsonp"},dataType:"jsonp"}).done(function(t){if(t&&0===t.code){var i=$('.follow-btn[data-mid="'+e.mid+'"]'),o=1===t.data.attribute||2===t.data.attribute||6===t.data.attribute,a=1===t.data.attribute;o&&i.addClass("followed").text("已关注"),a&&i.attr("quiet",!0)}})}var o=['<div class="hot-follow">','<button class="follow-btn" data-mid="'+e.mid+'" data-uname="'+s.unhtml(e.uname)+'" data-rpid="'+t+'">关注</button>',"</div>"].join("");return this.userStatus.isLogin&&i(e),o},t.prototype._createListCon=function(e,t,i){var o=this._parentBlacklistDom(e,t,i),a=['<div class="con '+(i==t?"no-border":"")+'">','<div class="user">'+this._identity(e.mid,e.assist,e.member.fans_detail),'<a data-usercard-mid="'+e.mid+'" href="//space.bilibili.com/'+e.mid+'" target="_blank" class="name '+this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)+'">'+s.unhtml(e.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+e.member.level_info.current_level+'"></i></a>'+this._createNameplate(e.member.nameplate)+"</div>",this._createMsgContent(e),'<div class="info">',e.floor?'<span class="floor">#'+e.floor+"</span>":"",this._createPlatformDom(e.content.plat),'<span class="time">'+this._formateTime(e.ctime)+"</span>",'<span class="like '+(1==e.action?"liked":"")+'"><i></i><span>'+(e.like?e.like:"")+"</span></span>",'<span class="hate '+(2==e.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(e.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(e)?'<li class="set-top">'+(e.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(e.mid)?'<li class="report">举报</li>':"")+(this._canDel(e.mid)&&!e.isTop?'<li class="del" data-mid="'+e.mid+'">删除</li>':"")+"</ul></div></div>",this._createVoteContent(e.content),"</div>",'<div class="reply-box">',this._createSubReplyList(e.replies,e.rcount,!1,e.rpid,e.folder&&e.folder.has_folded),"</div>",'<div class="paging-box">',"</div>","</div>"].join("");return s.browser.version.mobile&&(a=['<div class="con '+(i==t?"no-border":"")+'">','<div class="user">'+this._identity(e.mid,e.assist,e.member.fans_detail),'<a data-usercard-mid="'+e.mid+'" href="//space.bilibili.com/'+e.mid+'" target="_blank" class="name '+this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)+'">'+s.unhtml(e.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+e.member.level_info.current_level+'"></i></a>'+this._createNameplate(e.member.nameplate)+'<div class="right">',e.floor?'<span class="floor">#'+e.floor+"</span>":"",'<span class="time">'+this._formateMobileTime(e.ctime)+"</span></div>","</div>",this._createMsgContent(e),this._createVoteContent(e.content),'<div class="info">',this._createPlatformDom(e.content.plat),'<span class="like '+(1==e.action?"liked":"")+'"><i></i><span>'+(e.like?e.like:"")+"</span></span>",'<span class="hate '+(2==e.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(e.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(e)?'<li class="set-top">'+(e.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(e.mid)?'<li class="report">举报</li>':"")+(this._canDel(e.mid)&&!e.isTop?'<li class="del" data-mid="'+e.mid+'">删除</li>':"")+"</ul></div></div>","</div>",'<div class="reply-box">',this._createSubReplyList(e.replies,e.rcount,!1,e.rpid,e.folder&&e.folder.has_folded),"</div>",'<div class="paging-box">',"</div>","</div>"].join("")),e.state===this.blacklistCode?o:a},t.prototype._createSubFoldedListCon=function(e){var t=this._parentBlacklistDom(e,0),i=['<div class="con">','<div class="user">'+this._identity(e.mid,e.assist,e.member.fans_detail),'<a data-usercard-mid="'+e.mid+'" href="//space.bilibili.com/'+e.mid+'" target="_blank" class="name '+this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)+'">'+s.unhtml(e.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+e.member.level_info.current_level+'"></i></a>'+this._createNameplate(e.member.nameplate),"</div>",this._createMsgContent(e),'<div class="info">','<span class="time">'+this._formateTime(e.ctime)+"</span>",'<span class="like '+(1==e.action?"liked":"")+'"><i></i><span>'+(e.like?e.like:"")+"</span></span>",this._createReplyBtn(e.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(e)?'<li class="set-top">'+(e.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(e.mid)?'<li class="report">举报</li>':"")+(this._canDel(e.mid)&&!e.isTop?'<li class="del" data-mid="'+e.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("");return s.browser.version.mobile&&(i=['<div class="con">','<div class="user">'+this._identity(e.mid,e.assist,e.member.fans_detail),'<a data-usercard-mid="'+e.mid+'" href="//space.bilibili.com/'+e.mid+'" target="_blank" class="name '+this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)+'">'+s.unhtml(e.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+e.member.level_info.current_level+'"></i></a>'+this._createNameplate(e.member.nameplate),'<div class="right">','<span class="time">'+this._formateMobileTime(e.ctime)+"</span></div>","</div>",this._createMsgContent(e),'<div class="info">',this._createPlatformDom(e.content.plat),'<span class="like '+(1==e.action?"liked":"")+'"><i></i><span>'+(e.like?e.like:"")+"</span></span>",this._createReplyBtn(e.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(e)?'<li class="set-top">'+(e.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(e.mid)?'<li class="report">举报</li>':"")+(this._canDel(e.mid)&&!e.isTop?'<li class="del" data-mid="'+e.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("")),e.state===this.blacklistCode?t:i},t.prototype._createTopFoldedListCon=function(e){var t=this._parentBlacklistDom(e,0),i=['<div class="con">','<div class="user">'+this._identity(e.mid,e.assist,e.member.fans_detail),'<a data-usercard-mid="'+e.mid+'" href="//space.bilibili.com/'+e.mid+'" target="_blank" class="name '+this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)+'">'+s.unhtml(e.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+e.member.level_info.current_level+'"></i></a>'+this._createNameplate(e.member.nameplate),"</div>",this._createMsgContent(e),'<div class="info">',e.floor?'<span class="floor">#'+e.floor+"</span>":"",this._createPlatformDom(e.content.plat),'<span class="time">'+this._formateTime(e.ctime)+"</span>",'<span class="like '+(1==e.action?"liked":"")+'"><i></i><span>'+(e.like?e.like:"")+"</span></span>",'<span class="hate '+(2==e.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(e.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(e)?'<li class="set-top">'+(e.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(e.mid)?'<li class="report">举报</li>':"")+(this._canDel(e.mid)&&!e.isTop?'<li class="del" data-mid="'+e.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("");return s.browser.version.mobile&&(i=['<div class="con">','<div class="user">'+this._identity(e.mid,e.assist,e.member.fans_detail),'<a data-usercard-mid="'+e.mid+'" href="//space.bilibili.com/'+e.mid+'" target="_blank" class="name '+this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)+'">'+s.unhtml(e.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+e.member.level_info.current_level+'"></i></a>'+this._createNameplate(e.member.nameplate),'<div class="right">',e.floor?'<span class="floor">#'+e.floor+"</span>":"",'<span class="time">'+this._formateMobileTime(e.ctime)+"</span></div>","</div>",this._createMsgContent(e),'<div class="info">',this._createPlatformDom(e.content.plat),'<span class="like '+(1==e.action?"liked":"")+'"><i></i><span>'+(e.like?e.like:"")+"</span></span>",'<span class="hate '+(2==e.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(e.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(e)?'<li class="set-top">'+(e.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(e.mid)?'<li class="report">举报</li>':"")+(this._canDel(e.mid)&&!e.isTop?'<li class="del" data-mid="'+e.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("")),e.state===this.blacklistCode?t:i},t.prototype._createMsgContent=function(e){var t="";if(1===e.state){var i=this._resolveVote(this._resolveSeek(this._resolveEmoji(this._resolveAt(e.content.message,this._formateMemberMap(e.content.members||[])))),e.content);t='<a class="hidden-reply-toggle" href="javascript:;">[此楼层已被用户隐藏 点击查看]</a><div class="quote" style="display:none;">'+(e.isTop||e.isUpTop?'<span class="stick">置顶</span>':"")+i+"</div>"}else if([3,4].indexOf(e.state)!==-1)t='<p><a href="javascript:;">***</a></p>';else{var i=this._resolveVote(this._resolveSeek(this._resolveEmoji(this._resolveAt(e.content.message,this._formateMemberMap(e.content.members||[])))),e.content);t='<p class="text">'+(e.isTop||e.isUpTop?'<span class="stick">置顶</span>':"")+i+"</p>"}return t},t.prototype._createVoteContent=function(e){if(e.vote&&e.vote.id){e.vote.title=s.unhtml(e.vote.title);var t=['<div class="vote-container" data-id="'+e.vote.id+'" data-name="'+e.vote.title+'">','<div class="image-area">','<div class="share-img"></div>',"</div>",'<div class="text-area">','<div class="text-content">'+e.vote.title+"</div>",'<div class="text-desc">'+e.vote.cnt+"人参与</div>",'<div class="vote-btn-box">','<div class="vote-btn">投票</div>',"</div>","</div>","</div>"].join("");return t}return""},t.prototype._canSetTop=function(e){return!!this.userStatus.isLogin&&+this.upId===+this.userStatus.mid&&!e.isTop},t.prototype._canReport=function(e){return+e!==+this.userStatus.mid},t.prototype._canBlackList=function(e){return+e!==+this.userStatus.mid},t.prototype._identity=function(e,t,i){if(+this.upId===e)return'<span class="stick assist">UP</span>';if(t)return'<span class="stick assist">骑士</span>';if(i){var o=["#2EBDA7","#5896DE","#A068F1","#FF86B2","#F68D18"],a=o[Math.ceil(i.level/5)-1];return'<span class="stick true-love" style="border-color:'+a+";color:"+a+'">'+i.medal_name+'<span class="medal-level" style="border-color:'+a+'">'+i.level+"</span></span>"}return""},t.prototype._canDel=function(e){return!!this.userStatus.isLogin&&(+this.upId===+this.userStatus.mid||+this.userStatus.mid===+e||this.assist)},t.prototype._createReplyBtn=function(e){return e>0?'<span class="reply btn-hover btn-highlight">回复</span>':'<span class="reply btn-hover">回复</span>'},t.prototype._createNameplate=function(e){return e.image_small?'<div class="nameplate"><a class="nameplate-icon"'+(s.browser.version.mobile?"":'href="https://account.bilibili.com/site/nameplate.html" target="_blank"')+'><img src="'+s.trimHttp(s.webp(e.image_small,{w:32,h:32}))+'"></a><div class="nameplate-card"><i class="nameplate-arrow"></i><img class="nameplate-pic" src="'+s.trimHttp(s.webp(e.image,{w:62,h:62}))+'"><div class="nameplate-text"><p class="n-name">'+e.name+'</p><p class="n-title">'+e.condition+'</p><p class="n-type"><span>'+e.level+'</span><a href="https://account.bilibili.com/site/nameplate.html" target="_blank">查看全部>></a></p></div></div></div>':""},t.prototype._createPlatformDom=function(e){var t="";return 2===e?t="安卓客户端":3===e?t="iOS客户端":4===e&&(t="Windows Phone客户端"),t&&'<span class="plad">来自<a href="//app.bilibili.com/" target="_blank">'+t+"</a></span>"},t.prototype._checkId=function(e,t){for(var i=0,o=e.length;i<o;++i)if(+e[i].rpid===+t)return!0;return!1},t.prototype._createSubReplyList=function(e,t,i,o,a,s){var n="";if(!e||0===e.length)return n;for(var r=!!this.jumpId&&this._checkId(e,this.jumpId),l=i||r?e.length:Math.min(e.length,3),c=0;c<l;++c){var d=e[c],p=this._createSubReplyItem(d,c),m=this._subBlacklistDom(d);n+=d.state===this.blacklistCode?m:p}return(s||t<=3)&&a&&(n+='<div class="sub-reply-fold-tip"><a class="view-sub-fold" data-root="'+o+'">查看被折叠的回复</a><a href="'+this.folder.rule+'" class="fold-rule" target="_blank">（折叠规则）</a></div>'),!i&&!r&&t>3&&(n+='<div class="view-more">共<b>'+t+'</b>条回复, <a class="btn-more" data-pid="'+o+'" data-fold="'+a+'">点击查看</a></div>'),n},t.prototype._createSubReplyItem=function(e,t){var i=['<div class="reply-item reply-wrap" data-id="'+e.rpid+'" data-index="'+t+'">','<a href="//space.bilibili.com/'+e.mid+'" data-usercard-mid="'+e.mid+'" target="_blank" class="reply-face">','<img src="'+s.trimHttp(s.webp(e.member.avatar,{w:52,h:52}))+'" alt="">',"</a>",'<div class="reply-con">','<div class="user">','<a href="//space.bilibili.com/'+e.mid+'" target="_blank" data-usercard-mid="'+e.mid+'" class="name '+this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)+'">'+s.unhtml(e.member.uname)+"</a>",'<a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+e.member.level_info.current_level+'"></i></a>',this._createSubMsgContent(e),"</div>","</div>",'<div class="info">','<span class="time">'+this._formateTime(e.ctime)+"</span>",'<span class="like '+(1==e.action?"liked":"")+'"><i></i><span>'+(e.like?e.like:"")+"</span></span>",'<span class="reply btn-hover">回复</span>','<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>'+(this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(e.mid)?'<li class="report">举报</li>':"")+(this._canDel(e.mid)?'<li class="del" data-mid="'+e.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("");if(s.browser.version.mobile)var i=['<div class="reply-item reply-wrap" data-id="'+e.rpid+'" data-index="'+t+'">','<div class="reply-con">','<div class="user">','<a href="//space.bilibili.com/'+e.mid+'" target="_blank" data-usercard-mid="'+e.mid+'" class="name '+this._createVipClass(e.member.vip.vipType,e.member.vip.vipStatus,e.member.vip.themeType)+'">'+s.unhtml(e.member.uname)+"</a>",'<a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+e.member.level_info.current_level+'"></i>','<div class="right"><span class="time">'+this._formateMobileTime(e.ctime)+"</span></div>","</a>",this._createSubMsgContent(e),"</div>",'<div class="info">','<span class="like '+(1==e.action?"liked":"")+'"><i></i><span>'+(e.like?e.like:"")+"</span></span>",'<span class="reply btn-hover">回复</span>','<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>'+(this._canBlackList(e.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(e.mid)?'<li class="report">举报</li>':"")+(this._canDel(e.mid)?'<li class="del" data-mid="'+e.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>","</div>"].join("");return i},t.prototype._createSubMsgContent=function(e){var t="";return t=1===e.state?'<a class="hidden-reply-toggle" href="javascript:;">[此楼层已被用户隐藏 点击查看]</a><div class="quote" style="display:none;">'+this._resolveAt(e.content.message,this._formateMemberMap(e.content.members||[]))+"</div>":[3,4].indexOf(e.state)!==-1?'<a href="javascript:;">***</a>':'<span class="text-con">'+this._resolveEmoji(this._resolveAt(e.content.message,this._formateMemberMap(e.content.members||[])))+"</span>"},t.prototype._formateTime=function(e){if(!+e)return e;var t=Math.floor((new Date).getTime()/1e3),i=new Date;if(i.setHours(0),i.setMinutes(0),i.setSeconds(0),i=Math.floor(i.getTime()/1e3),e>i&&t-e>=0){if(t-e<=50){var o=10*Math.floor((t-e)%60/10);return(e>10?o:10)+"秒前"}return t-e<3600?Math.ceil((t-e)/60)+"分钟前":Math.ceil((t-e)/3600)+"小时前"}var a=new Date;a.setTime(1e3*e);var s=a.getMonth()+1,n=a.getDate(),r=a.getHours(),l=a.getMinutes();return s<10&&(s="0"+s),n<10&&(n="0"+n),r<10&&(r="0"+r),l<10&&(l="0"+l),a.getFullYear()+"-"+s+"-"+n+" "+r+":"+l},t.prototype._formateMobileTime=function(e){if(!+e)return e;var t=Math.floor((new Date).getTime()/1e3);if(t-e>=0){if(t-e<=50){var i=10*Math.floor((t-e)%60/10);return(e>10?i:10)+"秒前"}return t-e<3600?Math.ceil((t-e)/60)+"分钟前":t-e<86400?Math.ceil((t-e)/3600)+"小时前":t-e<2592e3?Math.ceil((t-e)/3600/24)+"天前":t-e<31536e3?Math.ceil((t-e)/3600/24/30)+"月前":Math.ceil((t-e)/3600/24/365)+"年前"}},t.prototype._getReplyByPage=function(e){var t=this;return $.ajax({url:p.reply,data:{jsonp:"jsonp",pn:e,type:t.pageType,oid:t.oid,sort:t.sort},dataType:"jsonp"})},t.prototype._getSubReplyByPage=function(e,t){var o=this;return $.ajax({url:p.subReply,data:{jsonp:"jsonp",pn:t,type:o.pageType,oid:o.oid,ps:i,root:e},dataType:"jsonp"})},t.prototype._getFoldedReply=function(e){var t={oid:this.oid,type:this.pageType,jsonp:"jsonp"};return e&&(t.next=e),$.ajax({url:p.folded,data:t,dataType:"jsonp"})},t.prototype._getSubFoldedReply=function(e,t){var i={oid:this.oid,type:this.pageType,root:e,jsonp:"jsonp"};return t&&(i.next=t),$.ajax({url:p.replyFolded,data:i,dataType:"jsonp"})},t.prototype._createVipClass=function(e,t,i){return 1===i&&2===e?"vip-green-name":2===e&&1===t?"vip-red-name":""},t.prototype._sendMsg=function(e,t,i){var o=this,a=$(e).find(".comment-submit"),s=$(e).find("textarea"),r=this.isSubReply,l=new RegExp(/\[[^\]]+_[^\]]+\]/g),c=t.msg.replace(l,"");if(c=c.replace(/(^\s*)|(\s*$)/g,""),c.length>this.contentMaxLength||c.length<2)return(new n).show(a,"请发送2到"+this.contentMaxLength+"字且非纯表情的评论",2e3,"error"),s.focus().parent().addClass("error"),!1;s.parent().removeClass("error"),a.text("发送中").addClass("disabled"),o.timer=setTimeout(function(){clearTimeout(o.timer),a.text("发表评论").removeClass("disabled"),(new n).show(e,"当前网速不太给力哦，请尝试重新提交~",2e3,"info")},5e3);var d=String(t.msg).replace(/\　{5,}/g,"　　　").replace(/\n{3,}/g,"\n\n\n")||t.msg,m=(r?this.atMsg:"")+d,u={oid:this.oid,type:this.pageType,root:t.rid,parent:t.pid,message:m,plat:t.plat,code:t.code,jsonp:"jsonp"};$.ajax({url:p.add,type:"POST",data:u,dataType:"json",xhrFields:{withCredentials:!0},success:function(t){if(t&&0===t.code){if(s.val(""),i&&i(t.data.rpid),t.data&&1==t.data.is_pending)return void(new n).show(a,"提交成功",2e3);if((new n).show(a,"发送成功",2e3),o._removeCaptcha(),o.dynamicRepost){var r=o.$root.find(".dynamic-repost-checkbox")[0].checked;r&&o.trigger("dynamicRepost",m,o.oid,o.userStatus.mid)}}else 12041===t.code?o._blackroomExamFB():61001===t.code||61002===t.code?$.getScript("//static.hdslb.com/common/js/identityDialog.js",function(){IdentityDialog(t.code,t.message)}):t&&(new n).show(a,t.message||"操作失败",2e3,"error");t&&t.data&&t.data.need_captcha?o._renderCaptcha(e,t.data.url):o._removeCaptcha(),o.trigger("commentSent",u,t),clearTimeout(o.timer),a.text("发表评论").removeClass("disabled")}})},t.prototype._renderCaptcha=function(e,t){var i='<div class="comment-captcha"><span>验证码：</span><input type="text" class="b-input" size="6" /><img src="'+s.trimHttp(t)+'"/></div>';e.find(".comment-captcha").remove(),e.append(i)},t.prototype._removeCaptcha=function(){$(".comment-captcha").remove()},t.prototype._reportFB=function(e,t,i,o){function a(e,a,s){var r=this,l={oid:t,type:i,rpid:o,reason:e,content:a,jsonp:"jsonp"};$.ajax({url:p.report,type:"post",data:l,xhrFields:{withCredentials:!0}}).done(function(e){0===e.code?((new n).show(s,"举报成功",1e3,"info"),$(".comment-report-bilibili-mask").remove()):12019==e.code?(new n).show(s,"举报过于频繁，请"+e.data.ttl+"秒后重试",1e3,"error"):(new n).show(s,e.message||"提交失败，请重试",1e3,"info"),r.trigger("report",l,e)})}var r=['<div class="comment-bilibili-mask comment-report-bilibili-mask" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-report-bilibili">','<div class="t">请选择举报理由<i class="btn-close"></i></div>','<div class="con">','<div class="reason-box"></div>','<div class="other">','<p class="btn-other"><input type="radio" name="reason" id="other" value="0" /><label for="other">其他</label></p>','<div class="ta"><textarea placeholder="自定义理由" value=""></textarea></div></div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit">确定</a><div>',"</div></div></div>"].join("");$(".comment-report-bilibili-mask").remove(),$("body").append(r);for(var l=[{type:"违反法律法规",list:[{name:"违法违规",reason:9},{name:"色情",reason:2},{name:"低俗",reason:10},{name:"赌博诈骗",reason:12}]},{type:"侵犯个人权益",list:[{name:"人身攻击",reason:7},{name:"侵犯隐私",reason:15}]},{type:"有害社区环境",list:[{name:"垃圾广告",reason:1},{name:"引战",reason:4},{name:"剧透",reason:5},{name:"刷屏",reason:3},{name:"抢楼",reason:16},{name:"视频不相关",reason:8},{name:"青少年不良信息",reason:17}]}],c=$(".comment-report-bilibili .reason-box"),d="",m=0,u=0;u<l.length;u++){d+='<dl class="clearfix"><dt>'+l[u].type+"</dt>";for(var f=0;f<l[u].list.length;f++)d+='<dd><input type="radio" name="reason" id="r'+m+'" value="'+l[u].list[f].reason+'" /><label for="r'+m+'">'+l[u].list[f].name+"</label></dd>",m++;d+="</dl>"}return c.append(d),$(".comment-report-bilibili").off("click.comment-report-close").on("click.comment-report-close",".btn-close,.btn-cancel",function(e){$(".comment-report-bilibili-mask").remove()}),$(".comment-report-bilibili").off("click.comment-report-label").on("click.comment-report-label","label",function(e){"other"===$(this).attr("for")?$(".comment-report-bilibili").find(".ta").show(200):$(".comment-report-bilibili").find(".ta").hide(200)}),$(".comment-report-bilibili").off("click.comment-report-submit").on("click.comment-report-submit",".btn-submit",function(e){var t=$(".comment-report-bilibili").find('input[type="radio"]:checked').val(),i=$(".comment-report-bilibili").find("textarea").val();t?"0"==t?i?s.getByteLen(i)>=2&&s.getByteLen(i)<=200?a(t,i,$(this)):(new n).show($(this),"自定义举报内容长度为2-200字符",1e3,"error"):(new n).show($(this),"请完善举报理由",1e3,"error"):a(t,i,$(this)):(new n).show($(this),"请选择举报理由",1e3,"error")}),!1},t.prototype._voteFB=function(e,t,i){var o=['<div class="comment-bilibili-mask comment-vote-bilibili-mask" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-vote-bilibili">','<div class="t">'+i+'<i class="btn-close"></i></div>','<div class="con">','<div class="vote-iframe"><iframe src="//t.bilibili.com/h5/dynamic/vote#/result?vote_id='+t+'&from=comment&isWeb=true" frameborder="0"></iframe></div>',"</div></div></div>"].join("");$(".comment-vote-bilibili-mask").remove(),$("body").append(o),$(".comment-vote-bilibili").off("click.comment-vote-close").on("click.comment-vote-close",".btn-close,.btn-cancel",function(e){$(".comment-vote-bilibili-mask").remove()})},t.prototype._blackListFB=function(e,t,i,o,a){var s=this,r=['<div class="comment-bilibili-mask comment-bilibili-blacklist" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con">','<div class="t">确认拉黑该用户<i class="btn-close"></i></div>','<div class="con">','<div class="text">拉黑该用户之后，将自动取消对他的关注，<br>并禁止该用户与我进行互动。</div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit">确定</a><div>',"</div></div></div>"].join("");$(".comment-bilibili-blacklist").remove(),$("body").append(r),$(".comment-bilibili-blacklist").off("click.comment-blacklist-close").on("click.comment-blacklist-close",".btn-close,.btn-cancel",function(e){$(".comment-bilibili-blacklist").remove()}),$(".comment-bilibili-blacklist").off("click.comment-blacklist-submit").on("click.comment-blacklist-submit",".btn-submit",function(t){var i=this;d.addBlacklist(o,function(t){if(0===t.code){var r="";if(a.hasClass("list-item")){var l=a.data("index"),c=s.fbData[l];r='<div class="user-face"><img src="'+s.noface+'"></div>'+s._parentBlacklistDom(c,l,s._pos),a.html(r)}if(a.hasClass("reply-item")){var l=a.parents(".list-item").data("index"),d=a.data("index"),c=s.fbData[l].replies[d];r=s._subBlacklistDom(c),$(r).insertAfter(a),a.remove()}(new n).show($(i),"加入黑名单成功",1e3,"info"),$(".comment-bilibili-blacklist").remove()}else(new n).show(e,"加入黑名单失败",1e3,"info"),$(".comment-bilibili-blacklist").remove();s.trigger("blackList",o,t)})})},t.prototype._blackroomExamFB=function(e,t,i,o,a){var s=['<div class="comment-bilibili-mask comment-bilibili-blackexam" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con">','<div class="t no-title"><i class="btn-close"></i></div>','<div class="con">','<div class="text">该账号处于封禁中，点击申请答题</div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit" target="_blank" href="//www.bilibili.com/blackroom/releaseexame.html">去答题</a><div>',"</div></div></div>"].join("");$("body").append(s),$(".comment-bilibili-blackexam").off("click.comment-blackexam-close").on("click.comment-blackexam-close",".btn-close,.btn-cancel,.btn-submit",function(e){$(".comment-bilibili-blackexam").remove()})},t.prototype._foldFB=function(e){var t=this;this._getFoldedReply(this.foldedNext).then(function(i){if(0!==i.code)return void(new n).show(e,i.message,2e3,"error");var o=i.data;t.foldedNext=o.cursor.next,t.foldIsEnd=o.cursor.is_end;var a="";o.replies.forEach(function(e){a+=t._createReplyItem(e,0)});var r=['<div class="comment-bilibili-mask comment-bilibili-fold'+(s.browser.version.mobile?"-h5":"")+'" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-fold-bilibili">','<div class="t">查看评论<i class="btn-close"></i></div>','<div class="comment-area"><div class="comment-list">',a,"</div></div>","</div>","</div>"].join("");$("body").append(r).addClass("preventScroll"),t._registerEvent(".comment-bilibili-fold"),t.foldDialogIsOpen=!0,$(".comment-fold-bilibili").off("click.comment-fold-close").on("click.comment-fold-close",".btn-close",function(e){$(".comment-bilibili-fold").remove(),$("body").removeClass("preventScroll"),t.foldDialogIsOpen=!1,t.foldedNext=null}),t._fixEmojiPosition(),t._needLoadMoreFold()&&t._loadMoreFold(),$(".comment-bilibili-fold .comment-area").off("scroll").on("scroll",function(){t._needLoadMoreFold()&&!t.isLoadingFold&&t._loadMoreFold()})})},t.prototype._subFoldFB=function(e,t){var i=this;this._getSubFoldedReply(t,this.subFoldedNext).then(function(o){if(0!==o.code)return void(new n).show(e,o.message,2e3,"error");var a=o.data;i.subFoldedNext=a.cursor.next,i.subFoldIsEnd=a.cursor.is_end;var r="";r+=i._createTopFoldedReplyItem(i.foldedReply[t]),r+='<p class="sub-fold-tip">被折叠评论</p>',a.replies.forEach(function(e,t){r+=i._createSubFoldedReplyItem(e,0===t)});var l=['<div class="comment-bilibili-mask comment-bilibili-fold comment-bilibili-sub-fold'+(s.browser.version.mobile?"-h5":"")+'" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-sub-fold-bilibili">','<div class="t">查看评论<i class="btn-close"></i></div>','<div class="comment-area"><div class="comment-list">',r,"</div></div>","</div>","</div>"].join("");$("body").append(l).addClass("preventScroll"),i._registerEvent(".comment-bilibili-fold"),i.subFoldDialogIsOpen=!0,$(".comment-sub-fold-bilibili").off("click.comment-sub-fold-close").on("click.comment-sub-fold-close",".btn-close",function(e){$(".comment-bilibili-sub-fold").remove(),$("body").removeClass("preventScroll"),i.subFoldDialogIsOpen=!1,i.subFoldedNext=null}),i._needLoadMoreSubFold()&&i._loadMoreSubFold(t),$(".comment-bilibili-fold .comment-area").off("scroll").on("scroll",function(){i._needLoadMoreSubFold()&&!i.isLoadingSubFold&&i._loadMoreSubFold(t)})})},t.prototype._needLoadMoreFold=function(){var e=$(".comment-fold-bilibili .comment-area"),t=$(".comment-fold-bilibili .comment-list"),i=e.height(),o=t.height(),a=e.scrollTop();return this.foldDialogIsOpen&&!this.foldIsEnd&&(o<=i+20||i+a+20>o)},t.prototype._loadMoreFold=function(){var e=this;e.isLoadingFold=!0,this._getFoldedReply(this.foldedNext).then(function(t){if(0===t.code){var i=t.data;e.foldedNext=i.cursor.next,e.foldIsEnd=i.cursor.is_end;var o="";i.replies.forEach(function(t){o=e._createReplyItem(t,0),$(".comment-fold-bilibili .comment-list").append(o)}),e.isLoadingFold=!1,e._fixEmojiPosition(),e._needLoadMoreFold()&&e._loadMoreFold()}}).fail(function(){e.isLoadingFold=!1})},t.prototype._needLoadMoreSubFold=function(){var e=$(".comment-sub-fold-bilibili .comment-area"),t=$(".comment-sub-fold-bilibili .comment-list"),i=e.height(),o=t.height(),a=e.scrollTop();return this.subFoldDialogIsOpen&&!this.subFoldIsEnd&&(o<=i+20||i+a+20>o)},t.prototype._loadMoreSubFold=function(e){var t=this;t.isLoadingSubFold=!0,this._getSubFoldedReply(e,this.subFoldedNext).then(function(e){if(0===e.code){var i=e.data;t.subFoldedNext=i.cursor.next,t.subFoldIsEnd=i.cursor.is_end;var o="";i.replies.forEach(function(e){o=t._createSubFoldedReplyItem(e),$(".comment-sub-fold-bilibili .comment-list").append(o)}),t.isLoadingSubFold=!1,t._needLoadMoreSubFold()&&t._loadMoreSubFold()}}).fail(function(){t.isLoadingSubFold=!1})},t.prototype._parentBlacklistDom=function(e,t,i){return['<div class="con '+(i==t?"no-border":"")+'">','<div class="user blacklist-font-color">黑名单用户</div>','<p class="text">由于黑名单设置，该评论已被隐藏。</p>','<div class="info">',e.floor?'<span class="floor">#'+e.floor+"</span>":"",this._createPlatformDom(e.content.plat),'<span class="time">'+this._formateTime(e.ctime)+"</span>",this._canDel(e.mid)?'<div class="operation btn-hover"><div class="spot"></div><div class="opera-list"><ul><li class="del" data-mid="'+e.mid+'">删除</li></ul></div></div>':"","</div>","</div>"].join("")},t.prototype._subBlacklistDom=function(e){return['<div class="reply-item reply-wrap" data-id="'+e.rpid+'">','<a class="reply-face"><img src="'+this.noface+'"></a>','<div class="reply-con">','<div class="user">','<span class="blacklist-font-color name">黑名单用户 </span> <span class="text-con">由于黑名单设置，该回复已被隐藏。</span>',"</div>","</div>",'<div class="info">','<span class="time">'+this._formateTime(e.ctime)+"</span>",this._canDel(e.mid)?'<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul><li class="del" data-mid="'+e.mid+'">删除</li></ul></div></div>':"","</div>","</div>"].join("")},t.prototype._setTop=function(e,t){return $.ajax({type:"post",url:p.setTop,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:e,action:t,jsonp:"jsonp"
},xhrFields:{withCredentials:!0}})},t.prototype._delReply=function(e){return $.ajax({type:"POST",url:p.del,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},t.prototype._likeReply=function(e,t){return $.ajax({type:"POST",url:p.like,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:e,action:t,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},t.prototype._hateReply=function(e,t){return $.ajax({type:"POST",url:p.hate,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:e,action:t,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},t.prototype._updateSubReplyByPage=function(e,t,i,o,a){var s=this;this._getSubReplyByPage(e,t).done(function(n){if(n&&0===n.code){var r=n.data.page,l=r.num*r.size>=r.count;i.find(".reply-box").html(s._createSubReplyList(n.data.replies,n.data.page.count,!0,e,a,l));var c=Math.ceil(n.data.page.count/n.data.page.size),d=i.find(".paging-box");i.find(".reply-box").attr("data-page",t).attr("data-total",n.data.page.count),c>1?d.paging({pageCount:c,current:t,backFn:function(t){s.$root.trigger("subReplyPageChange",{pid:e,page:t,parent:i,hasFolded:a})}}):i.find(".paging-box").html(""),s._fixEmojiPosition(),"function"==typeof o&&setTimeout(function(){o.call(null)},10)}}).fail(function(){})},t.prototype._registerEvent=function(e){function t(){$(window).off("scroll.comment").on("scroll.comment",function(){var e=o.$root.find(".bb-comment > .comment-send"),t=o.$root.find(".bb-comment > .comment-header");!o._isInView(o.$root)||o.loaded||o.loading||(o._showLoading("<span>loading...</span>"),o.edata?o.loadPage(1):o._getEmoji()),!o.noPage&&$(".comment-list").height()>$(window).height()&&(o._isInView(t,!0)?e.insertAfter(t):o._isInView(o.$root.find(".bottom-page"),!0)&&o.$root.find(".bb-comment").append(e))})}var o=this,a=this.$root;if(e)var a=$(e);a.off("click"),a.off("click.showMore").on("click.showMore",".btn-more",function(){var e=$(this).data("pid"),t=$(this).data("fold");o._updateSubReplyByPage(e,1,$(this).parents(".list-item:eq(0)"),null,t)}),a.off("subReplyPageChange").on("subReplyPageChange",function(e,t){o._updateSubReplyByPage(t.pid,t.page,t.parent,null,t.hasFolded)}),a.off("replyPageChange").on("replyPageChange",function(e,t){o.loadPage(t.p,t.isBottom)}),a.on("click.openMiniLogin",".btn-open-mini-Login",function(){o.quickLogin()}),a.on("click.emoji",".comment-emoji",function(e){var t=$(this).siblings(".textarea-container").find("textarea"),i=$(this).offset().left-o.$root.offset().left,a=$(this).offset().top-o.$root.offset().top+$(this).outerHeight(),s=$(this).parents(".comment-list").length>0;t.focus(),o.emoji.show(t,i,a,s),this!==o.$root[0]&&$(".emoji-box").css("zIndex",10001),e.stopPropagation()}),a.off("focus.textarea").on("focus.textarea","textarea",function(){$(this).parent().addClass("focus"),0===$(this).parents(".list-item").length&&(o.isSubReply=!1),s.browser.version.mobile&&$(window).off("scroll.comment")}),$(window).off("resize.comment").on("resize.comment",function(){o._fixEmojiPosition()}),a.off("blur.textarea").on("blur.textarea","textarea",function(){$(this).parent().removeClass("focus"),s.browser.version.mobile&&t()}),a.off("input.textarea").on("input.textarea","textarea",function(){$(this).parent().removeClass("error")}),a.on("click.sendMsg",".comment-submit",function(){var e=$(this).parent(),t=$(this).siblings("textarea").val()||"",a=void 0,s=e.find(".comment-captcha");if(!$(this).hasClass("disabled")){s.length>0&&(a=s.find("input").val());var n={rid:$(this).attr("data-rid"),pid:$(this).attr("data-pid"),msg:t,plat:1,code:a},r=$(this).parents(".list-item:eq(0)"),l=r.find(".reply-box"),c=+r.find(".reply-box").attr("data-page")||1,d=+r.find(".reply-box").attr("data-total")||0;o._sendMsg(e,n,function(e){n.rid?c!==Math.ceil(d/i)&&0!==d||o._appendSubReplyToTop(e,t,l):o._appendReplyToTop(e,t)})}}),a.on("click.report",".report",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var e=$(this).parents(".reply-wrap:eq(0)"),t=e.data("id");t&&o._reportFB($(this),o.oid,o.pageType,t)}),a.on("click.blacklist",".blacklist",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var e=$(this).parents(".reply-wrap:eq(0)"),t=e.find("[data-usercard-mid]:eq(0)").data("usercard-mid");t&&o._blackListFB($(this),o.oid,o.pageType,t,e)}),a.on("click.reply",".reply",function(){if(o.readOnly)return void(new n).show($(this),"评论区已被冻结，禁止发送评论",2e3,"ok");var e=$(this).parents(".list-item:eq(0)"),t=$(this).parents(".reply-wrap:eq(0)"),i=t.hasClass("reply-item"),a=i?"回复 @"+t.find(".user .name").text()+" :":"请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。";o.isSubReply=i,o.atMsg="回复 @"+t.find(".user .name").text()+" :";var s=e.attr("data-id"),r=t.attr("data-id"),l=!o.userStatus.isLogin||o.userStatus.level_info&&o.userStatus.level_info.current_level<2&&o.userStatus.mid!=o.upId&&1!=o.userStatus.vipStatus&&o.userStatus.official_verify&&o.userStatus.official_verify.type==-1;if(e.siblings(".list-item").removeClass("open-reply").find(".comment-send").remove(),e.hasClass("open-reply")){var c=e.find(".comment-send .comment-submit"),d=c.attr("data-rid")!==c.attr("data-pid");i||d?l?"":e.find(".comment-send textarea").focus().prop("placeholder",a).val(""):(e.find(".comment-send").remove(),e.removeClass("open-reply"))}else e.find(".con").append(o._createReplyBox({isSub:!0})),e.addClass("open-reply"),l?"":e.find(".comment-send textarea").focus().prop("placeholder",a).val("");e.find(".comment-send button.comment-submit").attr("data-rid",s).attr("data-pid",r)}),a.on("click",".follow-btn",function(){if(o.userStatus.isLogin){var e=$(this),t=$('.follow-btn[data-mid="'+e.data("mid")+'"]');e.hasClass("followed")?d.unFollow(e.data("mid"),function(i){if(0===i.code){var a={type:9,aid:o.oid,follow:!1};s.customReport("follow_click",a),o.trigger("follow",a),t.removeClass("followed").text("关注"),(new n).show(e,"取消关注成功!",500,"ok")}else(new n).show(e,i.message,500,"error")},e.attr("quiet"),122):d.follow(e.data("mid"),function(i){if(22006==i.code)return void $.getScript("//static.hdslb.com/plugins/attentionLimitPopup/attentionLimitPopup.js",function(){new attentionLimitPopup});if(0===i.code){var a={type:9,aid:o.oid,follow:!0};s.customReport("follow_click",a),o.trigger("follow",a),t.addClass("followed").text("已关注"),s.browser.version.mobile||$.getScript("//static.hdslb.com/common/js/followGroupDialog.js",function(){followGroupDialog(e.data("mid"),e.data("uname"),{showErrMsgInDialog:!1,onAddTagError:function(e){(new n).show($(".follow-dialog-window .submit"),e||"添加分组失败")},onSubmitError:function(e){(new n).show($(".follow-dialog-window .submit-move"),e||"移动分组失败")},onSubmitSuccess:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")},onEmptyTagSubmit:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")}})})}else(new n).show(e,i.message,500,"error")},122)}else s.browser.version.mobile?location.href="//passport.bilibili.com/login":$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(){window.biliQuickLogin(function(e){window.location.reload()})})}),a.on("click.delete",".del",function(){var e=$(this).parents(".reply-wrap:eq(0)"),t=+e.attr("data-id"),i=e.hasClass("list-item")?"删除评论后，评论下所有回复都会被删除":"删除评论后将不可恢复",a=$(this),s=a.attr("data-mid"),r=o.userStatus.mid==o.upId&&s!=o.upId;(new n).show(a,"<p>"+i+"</p><p>是否继续？</p>","button",function(){o._reportEvent(r?"upmaster_deletecomment":"user_deletecomment"),o._delReply(t).done(function(i){0===i.code?((new n).show(e,"删除成功"),e.hasClass("reply-item")?e.remove():o.loadPage(o.pageInfo.num||1)):(new n).show(e,i.message||"操作失败"),o.trigger("delete",t,i)})})}),a.on("click.set-top",".set-top",function(){var e=$(this),t=e.parents(".list-item:eq(0)"),i=+t.attr("data-id"),a=t.hasClass("is-top"),s=a?0:1,r=a?"取消成功":"置顶成功";return o.hasUpTop&&!a?void(new n).show(t,"<p>您只能置顶一条评论哦</p><p>先取消原来的吧！</p>"):(o._setTop(i,s).done(function(e){e&&0===e.code?((new n).show(t,r),o.loadPage(1)):(new n).show(t,e.message||"操作失败"),o.trigger("setTop",{rid:i,action:s},e)}),void o._reportEvent(a?"upmaster_cancelstick":"upmaster_stick"))}),a.on("click.like",".like",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var e,t=$(this),i=$(this).parents(".reply-wrap:eq(0)"),a=+i.attr("data-id"),s=t.siblings(".hate");e=t.hasClass("liked")?0:1,o._likeReply(a,e).then(function(i){if(i&&0===i.code){if(0===e){t.removeClass("liked");var r=+t.find("span").text()-1;t.find("span").text(r>0?r:"")}else if(1===e){t.addClass("liked");var r=+t.find("span").text()+1;t.find("span").text(r>0?r:""),s.removeClass("hated")}}else(new n).show(t,i.message||"操作失败");o.trigger("like",{rid:a,action:e},i)})}),a.on("click.hate",".hate",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var e,t=$(this),i=$(this).parents(".reply-wrap:eq(0)"),a=+i.attr("data-id"),s=t.siblings(".like");e=t.hasClass("hated")?0:1,o._hateReply(a,e).then(function(i){if(i&&0===i.code){if(0===e)t.removeClass("hated");else if(1===e&&(t.addClass("hated"),s.hasClass("liked"))){s.removeClass("liked");var r=+s.find("span").text()-1;s.find("span").text(r>0?r:"")}}else(new n).show(t,i.message||"操作失败");o.trigger("hate",{rid:a,action:e},i)})}),a.on("click.operation",".spot",function(e){$(".opera-list").hide(),$(this).siblings(".opera-list").show(),e.stopPropagation()}),$(document).off("click.hide-operation").on("click.hide-operation",function(){$(".opera-list").hide()}),a.off("mouseleave.operation").on("mouseleave.operation",".opera-list",function(e){$(".opera-list").hide()}),a.on("click.tab",".tabs-order li",function(){var e=$(this);e.hasClass("on")||(e.addClass("on").siblings().removeClass("on"),o.sort=+e.attr("data-sort"),o.loadPage(1)),"0"==e.attr("data-sort")&&s.videoReport("playpage_comment_allcomment"),"2"==e.attr("data-sort")&&s.videoReport("playpage_comment_hotcomment")}),a.on("click.moreHot",".more-hot",function(){o.$root.find(".tabs-order li").removeClass("on"),o.$root.find('.tabs-order li[data-sort="2"]').addClass("on"),o.sort=2,o.loadPage(1,!0),o.trigger("loadMoreHot")}),a.on("click.reload",".reload-comment",function(){o._showLoading("<span>loading...</span>"),o.loadPage(1),o.trigger("reload")}),a.on("click.notice",".reply-notice",function(){s.customReport("playpage_anoun")}),a.on("click.deletNotice",".icon-close-notice",function(){var e=$(this).parent(),t=+e.attr("data-id");if(f){var i=+window.localStorage.getItem(h);t>i&&window.localStorage.setItem(h,t)}e.remove(),o._reportEvent("comment_notice_close"),s.customReport("playpage_anoun_delete"),o.trigger("closeNotice")}),t(),a.on("click.captcha",".comment-captcha > img",function(){var e=$(this).get(0),t=e.src.indexOf("&_ts=");e.src=e.src.substr(0,t===-1?e.src.length:t)+"&_ts="+Date.now()}),a.on("click.hide",".hidden-reply-toggle",function(){$(this).siblings(".quote").slideToggle(200)}),a.on("click.notice",".notice-item a",function(){o._reportEvent("comment_notice_click")}),a.on("click.vote",".vote-container, .vote-link",function(){if(!o.userStatus.isLogin)return void o.quickLogin();var e=$(this).data("id"),t=$(this).data("name");s.browser.version.mobile&&(location.href="//t.bilibili.com/h5/dynamic/vote#/result?vote_id="+e+"&from=comment"),e&&o._voteFB($(this),e,t)}),a.on("click.space",".user-face a, .reply-face",function(){var e=$(this).data("usercard-mid");o.trigger("clickSpace",{type:"face",mid:e})}),a.on("click.space",".name",function(){var e=$(this).data("usercard-mid");o.trigger("clickSpace",{type:"name",mid:e})}),a.on("click.moreLink",".more-link",function(){o.trigger("moreLinkClick")}),this.on("repostSuc",function(){var e=o.$root.find(".dynamic-repost-checkbox");e[0].checked=!1}),this.on("repostFail",function(e){var t=o.$root.find(".dynamic-repost"),i=e.data&&e.data.errmsg;(new n).show(t,i,2e3,"error")}),this.on("repostError",function(e){var t=o.$root.find(".dynamic-repost"),i=e.msg;(new n).show(t,i,2e3,"error")}),a.on("click.seek",".video-seek",function(){if(window.commentAgent&&"function"==typeof window.commentAgent.seek){var e=$(this).data("time"),t=$(this).data("p");t<0?(window.commentAgent.seek(e),s.customReport("reply_timelink_click",{time:e})):(window.commentAgent.seek(e,t),s.customReport("reply_timelink_click",{time:e,p:t})),window.scrollTo(0,0)}}),a.on("click.fold",".view-fold",function(){s.customReport("foldingreply-click",1),o._foldFB(this)}),a.on("click.fold",".view-sub-fold",function(){s.customReport("foldingreply-click",1);var e=$(this).data("root");o._subFoldFB(this,e)}),a.on("click.fold-rule",".fold-rule",function(){s.customReport("foldingreply-click",2)})},t.prototype._isInView=function(e,t){if(e.length){var i=$(window).height(),o=e.offset().top-$(window).scrollTop();return t?o<=i&&o>=0:o<=i}},t.prototype._showLoading=function(e){this.$root.find(".comment-loading").remove(),this.$root.find(".bb-comment").append('<div class="comment-loading">'+e+"</div>")},t.prototype._hideLoading=function(){this.$root.find(".comment-loading").remove()},t.prototype.jumpToReply=function(e){var t=this;t.emoji||(t.emoji=new r(t.$root,t.userStatus.vipStatus,t.edata)),this.jumpId=e,t.loading=!0,$.ajax({url:p.jump,dataType:"jsonp",data:{jsonp:"jsonp",rpid:e,oid:t.oid,type:t.pageType}}).done(function(i){t._hideLoading(),t.loaded=!0,0===i.code?(t.mode=i.data.mode,t._renderTabs(i),t.blacklist=i.data.blacklist||0,t.assist=i.data.assist||0,t.pageInfo=i.data.page||{},t._renderNotice(i.data.notice),t._updateReplyListByData(i.data,t.pageInfo.num),t._renderTopPagination(t.pageInfo),t._renderBottomPagination(t.pageInfo),$(".common .b-head .results").html(i.data.page.acount||0).show(),i.data&&i.data.config&&i.data.config.showentry?$(".common .b-head .del-log").show():$(".common .b-head .del-log").remove(),t.$root.find(".bb-comment > .comment-send").remove(),$(t._createReplyBox()).insertBefore(t.$root.find(".comment-list")),t.jumpId="",setTimeout(function(){var i=$('[data-id="'+e+'"]');if(!i.length)return $(window).scrollTop(t.$root.offset().top),t._showMessage("评论已被删除",2500),void(window.console&&window.console.log("[comment] dom not find when jump"));if($(window).scrollTop(i.offset().top),i.hasClass("reply-item")){var o=i.parents(".list-item:eq(0)");t._updateSubReplyByPage(+o.attr("data-id"),t.pageInfo.rt_num,o,function(){$('[data-id="'+e+'"]').find(".reply").click()})}else i.hasClass("list-item")&&i.find(".con .reply").click()},100)):12002==i.code&&(t.$root.find(".bb-comment > .comment-send").remove(),$(t._createReplyBox(!0)).insertBefore(t.$root.find(".comment-list")))}).fail(function(){t.loaded||t._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')}).always(function(){t.loading=!1})},t.prototype._showMessage=function(e,t){$("body").append('<div class="comment-msg"><span>'+e+"</span></div>"),setTimeout(function(){$(".comment-msg").remove()},t||2e3)},t.prototype._reportEvent=function(e,t){"function"==typeof window.rec_rp&&window.rec_rp("event",e,t)},t.prototype._appendReplyToTop=function(e,t){var i={rpid:e,mid:this.userStatus.mid,type:1,count:0,rcount:0,floor:"",state:0,attr:0,ctime:"刚刚",like:0,action:0,member:{mid:this.userStatus.mid,uname:s.unhtml(this.userStatus.uname),avatar:this.userStatus.face,level_info:this.userStatus.level_info,pendant:this.userStatus.pendant,nameplate:{nid:0,name:"",image:"",image_small:"",level:"",condition:""},official_verify:this.userStatus.officialVerify,vip:{vipType:this.userStatus.vipType,vipDueDate:this.userStatus.vipDueDate,dueRemark:this.userStatus.dueRemark,accessStatus:this.userStatus.accessStatus,vipStatus:this.userStatus.vipStatus,vipStatusWarn:"",themeType:this.userStatus.vip_theme_type}},content:{message:s.unhtml(t),plat:1,device:"",members:[]},replies:null},o=$(this._createReplyItem(i,1)),a=this.$root.find(".comment-list .list-item:eq(0)");if(a.length>0?a.before(o):(this.$root.find(".no-more-reply").remove(),this.$root.find(".comment-list").append(o)),this.mounted){var n=this.fbData;n.unshift(i),this.mounted(n)}},t.prototype._appendSubReplyToTop=function(e,t,i){var o={rpid:e,mid:this.userStatus.mid,type:1,count:0,rcount:0,floor:"",state:0,attr:0,ctime:"刚刚",like:0,action:0,member:{mid:this.userStatus.mid,uname:s.unhtml(this.userStatus.uname),avatar:this.userStatus.face,level_info:this.userStatus.level_info,pendant:this.userStatus.pendant,nameplate:{nid:0,name:"",image:"",image_small:"",level:"",condition:""},official_verify:this.userStatus.officialVerify,vip:{vipType:this.userStatus.vipType,vipDueDate:this.userStatus.vipDueDate,dueRemark:this.userStatus.dueRemark,accessStatus:this.userStatus.accessStatus,vipStatus:this.userStatus.vipStatus,vipStatusWarn:"",themeType:this.userStatus.vip_theme_type}},content:{message:s.unhtml(t),plat:1,device:"",members:[]},replies:null},a=$(this._createSubReplyItem(o));i.prepend(a),this._fixEmojiPosition()},e.bbComment=t}(window)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,i){function o(e,t,i){this.container=e,this.isVip=t,this.data=i,this.defaultEmojis=["(⌒▽⌒)","（￣▽￣）","(=・ω・=)","(｀・ω・´)","(〜￣△￣)〜","(･∀･)","(°∀°)ﾉ","(￣3￣)","╮(￣▽￣)╭","( ´_ゝ｀)","←_←","→_→","(<_<)","(>_>)","(;¬_¬)",'("▔□▔)/',"(ﾟДﾟ≡ﾟдﾟ)!?","Σ(ﾟдﾟ;)","Σ( ￣□￣||)","(´；ω；`)","（/TДT)/","(^・ω・^ )","(｡･ω･｡)","(●￣(ｴ)￣●)","ε=ε=(ノ≧∇≦)ノ","(´･_･`)","(-_-#)","（￣へ￣）","(￣ε(#￣) Σ","ヽ(`Д´)ﾉ","(╯°口°)╯(┴—┴","（#-_-)┯━┯","_(:3」∠)_","(笑)","(汗)","(泣)","(苦笑)"],this.currentSelect=0,this.curPage=1,this.totalPage=1,this.tabNum=5,this.tabWidth=58,this.avalEmojiNum=1,this.emojiData=[],this.emojiDom="<div class='emoji-box'><div class='emoji-title'><span></span></div><div class='emoji-wrap'></div><div class='emoji-tabs'><div class='emoji-container'><div class='emoji-tab-wrap clearfix'></div></div></div></div>",this.init()}i(6);var a=i(1);o.prototype={init:function(){$(this.container).find(".emoji-box").remove(),$(this.container).append(this.emojiDom),this.emojiBox=$(this.container).find(".emoji-box"),this.hide();var e=$(this.container).find(".emoji-tabs"),t=$(this.container).find(".emoji-wrap"),i=$(this.container).find(".emoji-title"),o=this,s=this.data.free,n=this.data.vip;this.freeLength=s.length,this.defaultCursor=s.length;for(var r=0;r<s.length;r++)this.emojiData.push(s[r]),0==n[r].pstate&&this.avalEmojiNum++;if(this.emojiData.push({pname:"颜文字",pid:-1,pstate:0,emojis:this.defaultEmojis,purl:"//static.hdslb.com/images/base/emoji-tab-default.png"}),this.isVip)for(var r=0;r<n.length;r++)this.emojiData.push(n[r]),0==n[r].pstate&&this.avalEmojiNum++;this.createTabs(e),this.createEmoji(t,i,this.emojiData[0].pid),e.off("click.tab").on("click.tab",".tab-link",function(){o.currentSelect=+$(this).attr("data-index");var e=+$(this).data("pid");o.oldCurrentSelect=o.currentSelect,$(this).addClass("on").siblings(".tab-link").removeClass("on"),o.createEmoji(t,i,e)}),t.off("click").on("click",".emoji-list",function(e){var t=$(this).attr("data-emoji-text");o.insertAtCursor($(o.ta)[0],t),o.emojiBox.hide();var i=$(this),s=i.data("pid"),n=i.data("id"),r=i.data("index"),l={};s?l={pid:s,id:n}:r&&(l={index:r}),a.customReport("emoji_click",l)}),$(document).off("click.offEmoji").on("click.offEmoji",function(e){o.emojiBox.is(e.target)||0!==o.emojiBox.has(e.target).length||o.emojiBox.hide()}),e.off("click.prev").on("click.prev",".prev",function(){o.curPage>1&&o.curPage--,o.updateTabSlide()}),e.off("click.next").on("click.next",".next",function(){o.curPage<o.totalPage&&o.curPage++,o.updateTabSlide()})},updateTabSlide:function(){var e=$(this.container).find(".emoji-tab-slider"),t=e.find(".prev"),i=e.find(".next");this.curPage>1?t.addClass("on"):t.removeClass("on"),this.curPage<this.totalPage?i.addClass("on"):i.removeClass("on"),$(this.container).find(".emoji-tab-wrap").css({left:-1*(this.curPage-1)*this.tabWidth*this.tabNum})},createTabs:function(e){var t="";this.totalPage=Math.ceil(this.avalEmojiNum/this.tabNum);for(var i=0;i<this.emojiData.length;i++)if(0==this.emojiData[i].pstate){var o=this.currentSelect==i?"on":"",s=this.emojiData[i].pid;t+="<a class='tab-link "+o+"' data-index='"+i+"' data-pid='"+s+"'><img src='"+a.trimHttp(a.webp(this.emojiData[i].purl,{w:44,h:44}))+"'></a>"}e.find(".emoji-tab-wrap").html(t).css({width:this.emojiData.length*this.tabWidth,left:0}),e.find(".emoji-tab-slider").remove(),this.totalPage>1&&e.append('<div class="emoji-tab-slider clearfix"><span class="prev"></span><span class="next on"></span></div>')},createEmoji:function(e,t,i){if(t.find("span").text(this.emojiData[this.currentSelect].pname),this.currentSelect==this.defaultCursor){for(var o="",s=0;s<this.emojiData[this.defaultCursor].emojis.length;s++)o+="<a class='emoji-list emoji-text emoji-default' data-emoji-text='"+this.emojiData[this.defaultCursor].emojis[s]+"' data-index='"+s+"'>"+this.emojiData[this.defaultCursor].emojis[s]+"</a>";e.html("").append(o)}else{for(var o="",n=this.emojiData[this.currentSelect].emojis,s=0;s<n.length;s++)if(0==n[s].state){var r="emoji-list emoji-text emoji-pic";n[s].size&&"s"===n[s].size&&(r+=" emoji-small");var l=n[s].id;o+="<a class='"+r+"' data-emoji-text='"+n[s].name+"' data-pid='"+i+"' data-id='"+l+"'><img src='"+a.trimHttp(a.webp(n[s].url,{w:56,h:56}))+"' title='"+n[s].name+"'></a>"}e.html("").append(o)}},insertAtCursor:function(e,t){if(document.selection)e.focus(),sel=document.selection.createRange(),sel.text=t,sel.select();else if(e.selectionStart||"0"==e.selectionStart){var i=e.selectionStart,o=e.selectionEnd,a=e.scrollTop;e.value=e.value.substring(0,i)+t+e.value.substring(o,e.value.length),a>0&&(e.scrollTop=a),e.focus(),e.selectionStart=i+t.length,e.selectionEnd=i+t.length}else e.value+=t,e.focus()},show:function(e,t,i,o){this.ta=e,this.emojiBox.show().css({left:t,top:i}),$(this.container).find(".emoji-tabs .tab-link"),$(this.container).find(".emoji-tab-slider")},hide:function(){this.emojiBox.hide()}},e.exports=o},function(e,t,i){i(8);var o={init:function(e,t){return function(){o.fillHtml(e,t),o.bindEvent(e,t)}()},fillHtml:function(e,t){return function(){e.empty(),t.smallSize&&e.addClass("small"),pageOffset=t.smallSize?1:2,t.pageCount>1&&!t.jump&&e.append('<span class="result">共'+t.pageCount+"页</span>"),t.current>1?e.append('<a href="javascript:;" class="prev">上一页</a>'):(e.remove(".prev"),e.append('<span class="disabled">上一页</span>')),1!=t.current&&t.current>=pageOffset+2&&t.pageCount!=pageOffset+2&&e.append('<a href="javascript:;" class="tcd-number">1</a>'),t.current-pageOffset>2&&t.current<=t.pageCount&&t.pageCount>pageOffset+3&&e.append('<span class="dian">...</span>');var i=t.current-pageOffset,o=t.current+pageOffset;for((i>1&&t.current<pageOffset+2||1==t.current)&&o++,t.current>t.pageCount-(pageOffset+2)&&t.current>=t.pageCount&&i--;i<=o;i++)i<=t.pageCount&&i>=1&&(i!=t.current?e.append('<a href="javascript:;" class="tcd-number">'+i+"</a>"):e.append('<span class="current">'+i+"</span>"));if(t.current+pageOffset<t.pageCount-1&&t.current>=1&&t.pageCount>pageOffset+3&&e.append('<span class="dian">...</span>'),t.current!=t.pageCount&&t.current<t.pageCount-pageOffset&&t.pageCount!=pageOffset+2&&e.append('<a href="javascript:;" class="tcd-number">'+t.pageCount+"</a>"),t.current<t.pageCount?e.append('<a href="javascript:;" class="next">下一页</a>'):(e.remove(".next"),e.append('<span class="disabled">下一页</span>')),t.pageCount>1&&t.jump){var a='<div class="page-jump">';t.smallSize||(a+="共<span>"+t.pageCount+"</span>页，"),a+='跳至<input type="text" />页</div>',e.append(a)}}()},bindEvent:function(e,t){return function(){e.off("click"),e.off("keydown"),e.on("click","a.tcd-number",function(){var i=parseInt($(this).text());o.fillHtml(e,{current:i,pageCount:t.pageCount,jump:t.jump}),"function"==typeof t.backFn&&t.backFn(i)}),e.on("click","a.prev",function(){var i=parseInt(e.children("span.current").text());o.fillHtml(e,{current:i-1,pageCount:t.pageCount,jump:t.jump}),"function"==typeof t.backFn&&t.backFn(i-1)}),e.on("click","a.next",function(){var i=parseInt(e.children("span.current").text());o.fillHtml(e,{current:i+1,pageCount:t.pageCount,jump:t.jump}),"function"==typeof t.backFn&&t.backFn(i+1)}),e.on("keydown","input",function(i){if(13==i.keyCode){var a=Math.abs(parseInt($(this).val())),s=a?a:1;s=s>t.pageCount?t.pageCount:s,o.fillHtml(e,{current:s,pageCount:t.pageCount,jump:t.jump}),"function"==typeof t.backFn&&t.backFn(s)}})}()}};e.exports=o},function(e,t,i){function o(e){if(!s.browser.version.mobile){var t={isLogin:!1,vipStatus:0,vipType:0,mid:null};this.userStatus=$.extend(t,e),s.browser.version.mobile||this._registerEvent()}}i(9);var a=i(2),s=i(1),n=i(3),r={},l=new a,c=0;o.prototype.reset=function(e){this.userStatus=e,r={}},o.prototype._renderCard=function(e){$(".user-card").remove(),$("body").append(this._createCard(e)),s.videoReport("playpage_namecard2")},o.prototype._renderErrorCard=function(){$(".user-card").remove(),$("body").append(this._createErrorCard())},o.prototype._renderLoadingCard=function(){$(".user-card").remove(),$("body").append(this._createLoadingCard())},o.prototype._isLikeMe=function(e){if(e.card&&e.card.attentions)for(var t=0,i=e.card.attentions.length;t<i;++t)if(e.card.attentions[t]===this.userStatus.mid)return!0;return!1},o.prototype._createCard=function(e){var t=e.space.s_img?e.space.s_img:"//i0.hdslb.com/bfs/static/c9dae917e24b4fc17c4d544caf6b6c0b17f8692b.jpg",i=0===e.card.official_verify.type?'<i title="个人认证" class="auth p-auth"></i>':"",o=1===e.card.official_verify.type?'<i title="企业/团体认证" class="auth o-auth"></i>':"",a="保密"===e.card.sex?"":"男"===e.card.sex?'<i class="sex men"></i>':'<i class="sex women"></i>',n=e.card.sign?'<p class="sign">'+s.unhtml(e.card.sign)+"</p>":"",r="";r=1===e.card.vip.theme_type&&2===e.card.vip.vipType?"vip-green-name":2===e.card.vip.vipType&&1===e.card.vip.vipStatus?"vip-red-name":"";var l=this._isLikeMe(e),c=e.following?"已关注":"+关注",d=e.following?"liked":"";return d+=l?" liked-me":"",'<div class="user-card"><div class="bg" style="background-image:url('+s.trimHttp(s.webp(t,{w:750,h:240}))+')"></div><a target="_blank" href="//space.bilibili.com/'+e.card.mid+'" class="face"><img src="'+s.trimHttp(s.webp(e.card.face,{w:50,h:50}))+'" />'+i+o+'</a><div class="info"><p class="user"><a target="_blank" href="//space.bilibili.com/'+e.card.mid+'" class="name '+r+'">'+s.unhtml(e.card.name)+"</a>"+a+'<a href="//www.bilibili.com/html/help.html#k_'+e.card.level_info.current_level+'" target="_blank"><i class="level l'+e.card.level_info.current_level+'"></i></a></p><p class="social"><a href="//space.bilibili.com/'+e.card.mid+'/#!/fans/follow" target="_blank">关注: <span class="like">'+e.card.friend+'</span></a><a href="//space.bilibili.com/'+e.card.mid+'/#!/fans/fans" target="_blank">粉丝: <span class="fans">'+s.formatNum(e.card.fans)+"</span></a></p>"+n+'</div><div class="btn-box"><a class="like '+d+'" mid="'+e.card.mid+'" uname="'+s.unhtml(e.card.name)+'"'+(e.quiet?' quiet="true"':"")+'><span class="default-text">'+c+'</span><span class="hover-text">取消关注</span></a><a href="//message.bilibili.com/#whisper/mid'+e.card.mid+'" target="_blank" class="message">发消息</a></div></div>'},o.prototype._createErrorCard=function(){return'<div class="user-card"><p class="error-card">加载失败</p></div>'},o.prototype._createLoadingCard=function(){return'<div class="user-card"><p class="loading-card">正在加载中...请稍后。</p></div>'},o.prototype._setPosition=function(e){var t=$(e).offset().left,i=$(e).offset().top;if($(e).outerWidth(),$(e).offset().top<$(window).scrollTop()+$(".user-card").height()+32)var o=i+$(e).outerHeight()+8;else var o=i-$(".user-card").height()-32;$(e.height),$(".user-card").css({left:t,top:o})},o.prototype._registerEvent=function(){var e=this;$("body").off("click.userCardAttention").on("click.userCardAttention",".user-card .btn-box .like",function(){if(e.userStatus.isLogin){var t=$(this).hasClass("liked"),i=($(this).hasClass("liked-me"),$(this).attr("mid")),o=$(this).attr("uname"),a=this;t?(l.unFollow(i,function(e){e&&0===e.code?($(a).removeClass("liked").find(".default-text").text("+关注"),delete r[i],(new n).show($(a),"取消关注成功!",1e3,"ok")):e&&(new n).show($(a),e.message,1e3,"error")},$(this).attr("quiet")),s.videoReport("playpage_unfollow2")):(l.follow(i,function(e){22006==e.code?$.getScript("//static.hdslb.com/plugins/attentionLimitPopup/attentionLimitPopup.js",function(){new attentionLimitPopup}):e&&0===e.code?($(a).text("取消关注").addClass("liked"),$.getScript("//static.hdslb.com/common/js/followGroupDialog.js",function(){$(".user-card").remove(),followGroupDialog(i,o,{showErrMsgInDialog:!1,onAddTagError:function(e){(new n).show($(".follow-dialog-window .submit"),e||"添加分组失败")},onSubmitError:function(e){(new n).show($(".follow-dialog-window .submit-move"),e||"移动分组失败")},onSubmitSuccess:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")},onEmptyTagSubmit:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")}})}),delete r[i]):e&&(new n).show($(a),e.message,1e3,"error")}),s.videoReport("playpage_follow2"))}else document.location.href="https://account.bilibili.com/login"}),$("body").on("mouseenter.data-userCard","[data-usercard-mid]",function(t){var i=$(this).attr("data-usercard-mid"),o=this;clearTimeout(c),c=setTimeout(function(){r[i]?(e._renderCard(r[i]),e._setPosition(o)):(e._renderLoadingCard(),e._setPosition(o),$.ajax({url:"//api.bilibili.com/x/web-interface/card",dataType:"jsonp",data:{mid:i,photo:1,jsonp:"jsonp"},dataType:"jsonp",cache:!0,success:function(t){t&&0===t.code&&$.ajax({url:"//api.bilibili.com/x/relation",data:{fid:i,jsonp:"jsonp"},dataType:"jsonp"}).done(function(i){i&&0===i.code?(t.data.following=1===i.data.attribute||2===i.data.attribute||6===i.data.attribute,t.data.quiet=1===i.data.attribute):t.data.following=!1,e._renderCard(t.data),e._setPosition(o),r[t.data.card.mid]=t.data}).fail(function(){e._renderErrorCard(),e._setPosition(o)})},error:function(){e._renderErrorCard(),e._setPosition(o)}}))},300)}),$("body").on("mouseleave.data-userCard","[data-usercard-mid]",function(e){clearTimeout(c),c=setTimeout(function(){$(".user-card").remove()},100)}),$("body").on("mouseenter.userCard",".user-card",function(e){clearTimeout(c)}),$("body").on("mouseleave.userCard",".user-card",function(e){$(".user-card").remove()})},e.exports=o}]);